import{_ as e,r as o,o as c,a as l,b as n,d as a,w as p,F as u,e as t,c as r}from"./app.3f041a55.js";const i={},k={class:"table-of-contents"},b=t("[1]\u5E38\u7528\u5DE5\u5177\u7C7B\u5C01\u88C5"),m=t("EventEmitter"),d=t("resize"),w=t("Time"),y=t("[2]\u6838\u5FC3\u7C7B\u5C01\u88C5"),h=t("scene"),f=t("camera"),g=t("renderer"),v=t("[3]World"),x=t("Environment"),E=t("Resources"),T=t("fox"),R=t("[4]Debug"),_=t("[5]\u9500\u6BC1\u573A\u666F\u4E2D\u6240\u6709\u7684\u7269\u4F53"),M=r(`<p>\u901A\u5E38\u5BF9\u4E8E\u7A0D\u5FAE\u5927\u4E9B\u7684\u9879\u76EE\u6216\u8005demo\uFF0C\u90FD\u9700\u8981\u5BF9three.js\u7684\u4EE3\u7801\u7ED3\u6784\u8FDB\u884C\u62C6\u5206\uFF0C\u6709\u5229\u4E8E\u590D\u7528\u3001\u4EE3\u7801\u53EF\u8BFB\u6027\u3001\u6269\u5C55\u6027</p><p>\u4F8B\u5982\u4E0B\u9762\u7684\u4E00\u4E2A\u7B80\u5355\u7684scene\u4EE3\u7801\u76F4\u63A5\u5C06\u6240three.js\u4EE3\u7801\u90FD\u6DFB\u52A0\u5230\u4E86\u4E00\u4E2A\u6587\u4EF6\u4E2D\u90FD\u4F1A\u6709\u70B9\u96BE\u53D7\u4E86\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">&#39;./style.css&#39;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;three/examples/jsm/controls/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> dat <span class="token keyword">from</span> <span class="token string">&#39;lil-gui&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GLTFLoader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;three/examples/jsm/loaders/GLTFLoader.js&#39;</span>

<span class="token comment">/**
 * Loaders
 */</span>
<span class="token keyword">const</span> gltfLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cubeTextureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * Base
 */</span>
<span class="token comment">// Debug</span>
<span class="token keyword">const</span> gui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dat</span><span class="token punctuation">.</span><span class="token constant">GUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> debugObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Canvas</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;canvas.webgl&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// Scene</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * Update all materials
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateAllMaterials</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>Mesh <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>material <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>MeshStandardMaterial<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// child.material.envMap = environmentMap</span>
            child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMapIntensity <span class="token operator">=</span> debugObject<span class="token punctuation">.</span>envMapIntensity
            child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
            child<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
            child<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Environment map
 */</span>
<span class="token keyword">const</span> environmentMap <span class="token operator">=</span> cubeTextureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">&#39;/textures/environmentMap/px.jpg&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/textures/environmentMap/nx.jpg&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/textures/environmentMap/py.jpg&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/textures/environmentMap/ny.jpg&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/textures/environmentMap/pz.jpg&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/textures/environmentMap/nz.jpg&#39;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

environmentMap<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding

<span class="token comment">// scene.background = environmentMap</span>
scene<span class="token punctuation">.</span>environment <span class="token operator">=</span> environmentMap

debugObject<span class="token punctuation">.</span>envMapIntensity <span class="token operator">=</span> <span class="token number">0.4</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;envMapIntensity&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>updateAllMaterials<span class="token punctuation">)</span>

<span class="token comment">/**
 * Models
 */</span>
<span class="token keyword">let</span> foxMixer <span class="token operator">=</span> <span class="token keyword">null</span>

gltfLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
    <span class="token string">&#39;/models/Fox/glTF/Fox.gltf&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>gltf<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Model</span>
        gltf<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">)</span>
        scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span>

        <span class="token comment">// Animation</span>
        foxMixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">AnimationMixer</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
        <span class="token keyword">const</span> foxAction <span class="token operator">=</span> foxMixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span>gltf<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        foxAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// Update materials</span>
        <span class="token function">updateAllMaterials</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">/**
 * Floor
 */</span>
<span class="token keyword">const</span> floorColorTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&#39;textures/dirt/color.jpg&#39;</span><span class="token punctuation">)</span>
floorColorTexture<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
floorColorTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
floorColorTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
floorColorTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping

<span class="token keyword">const</span> floorNormalTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&#39;textures/dirt/normal.jpg&#39;</span><span class="token punctuation">)</span>
floorNormalTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
floorNormalTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
floorNormalTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping

<span class="token keyword">const</span> floorGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">CircleGeometry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> floorMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    map<span class="token operator">:</span> floorColorTexture<span class="token punctuation">,</span>
    normalMap<span class="token operator">:</span> floorNormalTexture
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Mesh</span><span class="token punctuation">(</span>floorGeometry<span class="token punctuation">,</span> floorMaterial<span class="token punctuation">)</span>
floor<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>floor<span class="token punctuation">)</span>

<span class="token comment">/**
 * Lights
 */</span>
<span class="token keyword">const</span> directionalLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">DirectionalLight</span><span class="token punctuation">(</span><span class="token string">&#39;#ffffff&#39;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">15</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
directionalLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>normalBias <span class="token operator">=</span> <span class="token number">0.05</span>
directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span> <span class="token number">1.25</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">)</span>

gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">,</span> <span class="token string">&#39;intensity&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&#39;lightIntensity&#39;</span><span class="token punctuation">)</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&#39;lightX&#39;</span><span class="token punctuation">)</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&#39;lightY&#39;</span><span class="token punctuation">)</span>
gui<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>directionalLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">&#39;z&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&#39;lightZ&#39;</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * Sizes
 */</span>
<span class="token keyword">const</span> sizes <span class="token operator">=</span> <span class="token punctuation">{</span>
    width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
    height<span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Update sizes</span>
    sizes<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
    sizes<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight

    <span class="token comment">// Update camera</span>
    camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> sizes<span class="token punctuation">.</span>height
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Update renderer</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * Camera
 */</span>
<span class="token comment">// Base camera</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> sizes<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span>

<span class="token comment">// Controls</span>
<span class="token keyword">const</span> controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token comment">/**
 * Renderer
 */</span>
<span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    canvas<span class="token operator">:</span> canvas<span class="token punctuation">,</span>
    antialias<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
renderer<span class="token punctuation">.</span>physicallyCorrectLights <span class="token operator">=</span> <span class="token boolean">true</span>
renderer<span class="token punctuation">.</span>outputEncoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
renderer<span class="token punctuation">.</span>toneMapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>CineonToneMapping
renderer<span class="token punctuation">.</span>toneMappingExposure <span class="token operator">=</span> <span class="token number">1.75</span>
renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span>
renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap
renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token string">&#39;#211d20&#39;</span><span class="token punctuation">)</span>
renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * Animate
 */</span>
<span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> previousTime <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">const</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">getElapsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> deltaTime <span class="token operator">=</span> elapsedTime <span class="token operator">-</span> previousTime
    previousTime <span class="token operator">=</span> elapsedTime

    <span class="token comment">// Update controls</span>
    controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Fox animation</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>foxMixer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        foxMixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>deltaTime<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Render</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>

    <span class="token comment">// Call tick again on the next frame</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br></div></div><p>\u4E0B\u9762\u5BF9\u5C31\u4E0A\u9762\u7684\u4EE3\u7801\u529F\u80FD\u8FDB\u884C\u62C6\u5206\u91CD\u65B0\u7EC4\u7EC7\u7ED3\u6784\uFF1A \u91CD\u65B0\u7EC4\u7EC7\u7684\u4EE3\u7801\u76EE\u5F55\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>core
\u251C\u2500\u2500 utils
\u2502   \u251C\u2500\u2500 debug.js
\u2502   \u251C\u2500\u2500 eventEmitter.js
\u2502   \u251C\u2500\u2500 size.js
\u2502   \u251C\u2500\u2500 resources.js
\u2502   \u2514\u2500\u2500 time.js
\u251C\u2500\u2500 world
\u2502   \u251C\u2500\u2500 Modal
\u2502   \u251C\u2500\u2500 Form
\u2502   \u2514\u2500\u2500 Table
\u251C\u2500\u2500 core.js
\u251C\u2500\u2500 camera.js
\u251C\u2500\u2500 sources.js
\u2514\u2500\u2500 renderer.js

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_1-\u5E38\u7528\u5DE5\u5177\u7C7B\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_1-\u5E38\u7528\u5DE5\u5177\u7C7B\u5C01\u88C5" aria-hidden="true">#</a> [1]\u5E38\u7528\u5DE5\u5177\u7C7B\u5C01\u88C5</h2><h3 id="eventemitter" tabindex="-1"><a class="header-anchor" href="#eventemitter" aria-hidden="true">#</a> EventEmitter</h3><p>\u8BE5\u7C7B\u7528\u6765\u7BA1\u7406\u548C\u8C03\u5EA6\u4E8B\u4EF6\uFF0C\u7C7B\u4F3CNode.js\u5185\u7F6E\u7684events\u6A21\u5757\uFF0C\u8FD9\u4E2AEventEmitter\u7C7B\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7075\u6D3B\u7684\u65B9\u5F0F\u6765\u7BA1\u7406\u548C\u89E6\u53D1\u81EA\u5B9A\u4E49\u7684\u4E8B\u4EF6\u3002\u5176\u4E2Don\uFF0Coff\uFF0C\u548Ctrigger\u65B9\u6CD5\u662F\u4E8B\u4EF6\u7684\u6DFB\u52A0\uFF0C\u79FB\u9664\uFF0C\u548C\u89E6\u53D1\uFF0C\u800CresolveNames\u548CresolveName\u5219\u662F\u5185\u90E8\u8F85\u52A9\u65B9\u6CD5\uFF0C\u7528\u4E8E\u5904\u7406\u548C\u89E3\u6790\u4E8B\u4EF6\u540D\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>base <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">on</span><span class="token punctuation">(</span>_names<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Errors</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _names <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">||</span> _names <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;wrong names&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;wrong callback&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Resolve names</span>
        <span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span>

        <span class="token comment">// Each name</span>
        names<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// Resolve name</span>
            <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

            <span class="token comment">// Create namespace if not exist</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

            <span class="token comment">// Create callback if not exist</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token comment">// Add callback</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>

    <span class="token function">off</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Errors</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _names <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">||</span> _names <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;wrong name&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Resolve names</span>
        <span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span>

        <span class="token comment">// Each name</span>
        names<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// Resolve name</span>
            <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

            <span class="token comment">// Remove namespace</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">!==</span> <span class="token string">&#39;base&#39;</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Remove specific callback in namespace</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">// Default</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">===</span> <span class="token string">&#39;base&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// Try to remove from each namespace</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">namespace</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span>

                            <span class="token comment">// Remove namespace if empty</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
                                <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Specified namespace</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span>

                    <span class="token comment">// Remove namespace if empty</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
                        <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>

    <span class="token function">trigger</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Errors</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _name <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">||</span> _name <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;wrong name&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> finalResult <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">null</span>

        <span class="token comment">// Default args</span>
        <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span>_args <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> _args

        <span class="token comment">// Resolve names (should on have one event)</span>
        <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

        <span class="token comment">// Resolve name</span>
        name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment">// Default namespace</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">===</span> <span class="token string">&#39;base&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// Try to find callback in each namespace</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">namespace</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        result <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> finalResult <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            finalResult <span class="token operator">=</span> result
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Specified namespace</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;wrong name&#39;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
                result <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> finalResult <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span>
                    finalResult <span class="token operator">=</span> result
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> finalResult
    <span class="token punctuation">}</span>

    <span class="token function">resolveNames</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> names <span class="token operator">=</span> _names
        names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[^a-zA-Z0-9 ,/.]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[,/]+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">)</span>
        names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> names
    <span class="token punctuation">}</span>

    <span class="token function">resolveName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> newName <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> parts <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span>

        newName<span class="token punctuation">.</span>original  <span class="token operator">=</span> name
        newName<span class="token punctuation">.</span>value     <span class="token operator">=</span> parts<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span>
        newName<span class="token punctuation">.</span>namespace <span class="token operator">=</span> <span class="token string">&#39;base&#39;</span> <span class="token comment">// Base namespace</span>

        <span class="token comment">// Specified namespace</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> parts<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            newName<span class="token punctuation">.</span>namespace <span class="token operator">=</span> parts<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> newName
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br></div></div><ul><li><code>constructor()</code>: \u6784\u9020\u5668\uFF0C\u7528\u4E8E\u521D\u59CB\u5316\u4E8B\u4EF6\u56DE\u8C03\u96C6\uFF0C\u5176\u4E2D<code>this.callbacks</code>\u5BF9\u8C61\u5C06\u5B58\u50A8\u6240\u6709\u4E8B\u4EF6\u7684\u56DE\u8C03\u51FD\u6570</li><li><code>on(_names, callback)</code>: \u6B64\u65B9\u6CD5\u7528\u4E8E\u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\u5668\uFF0C\u63A5\u53D7\u4E8B\u4EF6\u540D<code>(_names)</code>\u548C\u56DE\u8C03\u51FD\u6570(callback)\u4E24\u4E2A\u53C2\u6570\u3002\u6B64\u65B9\u6CD5\u9996\u5148\u4F1A\u68C0\u67E5\u53C2\u6570\u7684\u6709\u6548\u6027\uFF0C\u7136\u540E\u89E3\u6790\u4E8B\u4EF6\u540D\uFF0C\u6700\u540E\u5C06\u56DE\u8C03\u51FD\u6570\u5B58\u50A8\u5230this.callbacks\u5BF9\u8C61\u4E2D\u3002\u5982\u679C\u4E8B\u4EF6\u540D\u5305\u542B\u547D\u540D\u7A7A\u95F4\uFF0C\u90A3\u4E48\u5B83\u4F1A\u6309\u7167\u547D\u540D\u7A7A\u95F4\u5B58\u50A8\u3002\u6B64\u65B9\u6CD5\u8FD4\u56DE\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u4EE5\u652F\u6301\u94FE\u5F0F\u8C03\u7528\u3002</li><li><code>off(_names)</code>: \u6B64\u65B9\u6CD5\u7528\u4E8E\u79FB\u9664\u4E8B\u4EF6\u76D1\u542C\u5668\uFF0C\u63A5\u53D7\u4E00\u4E2A\u53C2\u6570\uFF0C\u4E8B\u4EF6\u540D<code>(_names)</code>\u3002\u5B83\u4F1A\u89E3\u6790\u4E8B\u4EF6\u540D\u5E76\u5C1D\u8BD5\u4ECE<code>this.callbacks</code>\u5BF9\u8C61\u4E2D\u79FB\u9664\u5BF9\u5E94\u7684\u56DE\u8C03\u51FD\u6570\u3002\u6B64\u65B9\u6CD5\u4E5F\u8FD4\u56DE\u7C7B\u7684\u5B9E\u4F8B\uFF0C\u4EE5\u652F\u6301\u94FE\u5F0F\u8C03\u7528</li><li><code>trigger(_name, _args):</code> \u6B64\u65B9\u6CD5\u7528\u4E8E\u89E6\u53D1\u67D0\u4E2A\u4E8B\u4EF6\uFF0C\u63A5\u53D7\u4E8B\u4EF6\u540D(_name)\u548C\u53C2\u6570\u5217\u8868(_args)\u4E24\u4E2A\u53C2\u6570\u3002\u6B64\u65B9\u6CD5\u9996\u5148\u4F1A\u89E3\u6790\u4E8B\u4EF6\u540D\uFF0C\u7136\u540E\u67E5\u627E\u5E76\u8C03\u7528\u5BF9\u5E94\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u4F20\u5165\u7ED9\u5B9A\u7684\u53C2\u6570\u3002\u5982\u679C\u5B58\u5728\u591A\u4E2A\u540C\u540D\u4E8B\u4EF6\uFF0C\u6B64\u65B9\u6CD5\u5C06\u8FD4\u56DE\u6700\u540E\u4E00\u4E2A\u4E8B\u4EF6\u56DE\u8C03\u51FD\u6570\u7684\u8FD4\u56DE\u503C\u3002</li><li><code>resolveNames(_names):</code> \u6B64\u65B9\u6CD5\u7528\u4E8E\u89E3\u6790\u4E8B\u4EF6\u540D\uFF0C\u63A5\u53D7\u4E00\u4E2A\u53C2\u6570\uFF0C\u4E8B\u4EF6\u540D(_names)\u3002\u5B83\u4F1A\u6E05\u7406\u4E8B\u4EF6\u540D\u4E2D\u7684\u975E\u5B57\u6BCD\u548C\u6570\u5B57\u5B57\u7B26\uFF0C\u7136\u540E\u6839\u636E\u7A7A\u683C\u3001\u9017\u53F7\u548C\u659C\u6760\u5206\u5272\u4E8B\u4EF6\u540D\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B\u6240\u6709\u4E8B\u4EF6\u540D\u7684\u6570\u7EC4\u3002</li><li><code>resolveName(name)</code>: \u6B64\u65B9\u6CD5\u7528\u4E8E\u89E3\u6790\u5355\u4E2A\u4E8B\u4EF6\u540D\uFF0C\u63A5\u53D7\u4E00\u4E2A\u53C2\u6570\uFF0C\u4E8B\u4EF6\u540D(name)\u3002\u5B83\u5C06\u4E8B\u4EF6\u540D\u5206\u5272\u4E3A\u4E8B\u4EF6\u503C\u548C\u547D\u540D\u7A7A\u95F4\u4E24\u90E8\u5206\uFF0C\u5E76\u8FD4\u56DE\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5305\u542B\u539F\u59CB\u4E8B\u4EF6\u540D\uFF0C\u4E8B\u4EF6\u503C\u548C\u547D\u540D\u7A7A\u95F4\u3002</li></ul><h3 id="resize" tabindex="-1"><a class="header-anchor" href="#resize" aria-hidden="true">#</a> resize</h3><p>\u8BE5\u7C7B\u7EE7\u627F\u4E8B\u4EF6\u7C7B<code>EventEmitter</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">&#39;./EventEmitter.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// Setup</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
        <span class="token keyword">this</span><span class="token punctuation">.</span>pixelRatio <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment">// Resize event</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
            <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
            <span class="token keyword">this</span><span class="token punctuation">.</span>pixelRatio <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u5728<code>Core</code>\u7C7B\u4E2D\u4F7F\u7528\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">&#39;./Utils/Sizes.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  
  <span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token comment">// Resize event</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;A resize occurred&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u540E\u7EED</span>
    <span class="token comment">// this.camera.resize()</span>
    <span class="token comment">// this.renderer.resize()</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>\u5982\u679C\u76F4\u63A5\u5728<code>Sizes</code>\u7C7B\u4E2D\u4F7F\u7528<code>window.addEventListener(&#39;resize&#39;, () =&gt;{})</code>\uFF0C\u5E76\u5728Experience\u7C7B\u4E2D\u76F4\u63A5\u5B9E\u4F8B\u5316\u8C03\u7528\u7684\u8BDD\uFF0C\u867D\u7136\u4E5F\u53EF\u4EE5\u5B9E\u73B0\u529F\u80FD\uFF0C\u4F46\u662F\u5982\u679C\u6709\u5176\u4ED6\u7C7B\u6216\u8005\u51FD\u6570\u4E5F\u9700\u8981\u4F7F\u7528\u5230\u7A97\u53E3\u5C3A\u5BF8\u53D8\u5316\u7684\u4E8B\u4EF6\uFF0C\u5C31\u9700\u8981\u91CD\u590D\u7F16\u5199\u83B7\u53D6\u548C\u66F4\u65B0\u7A97\u53E3\u5C3A\u5BF8\u7684\u903B\u8F91\uFF0C\u8FD9\u4F1A\u589E\u52A0\u4EE3\u7801\u7684\u5197\u4F59\u6027\u3002</p><p>\u6B64\u5916\uFF0C<code>EventEmitter</code>\u8FD8\u63D0\u4F9B\u4E86\u8BB8\u591A\u6709\u7528\u7684\u65B9\u6CD5\uFF0C\u4F8B\u5982\u53EF\u4EE5\u540C\u65F6\u6DFB\u52A0\u591A\u4E2A\u76D1\u542C\u5668\uFF0C\u53EF\u4EE5\u79FB\u9664\u76D1\u542C\u5668\uFF0C\u53EF\u4EE5\u4E00\u6B21\u89E6\u53D1\u591A\u4E2A\u4E8B\u4EF6\u7B49\uFF0C\u8FD9\u4E9B\u5728\u76F4\u63A5\u4F7F\u7528<code>window.addEventListener(&#39;resize&#39;, () =&gt;{})</code>\u662F\u4E0D\u5177\u5907\u7684</p></blockquote><h3 id="time" tabindex="-1"><a class="header-anchor" href="#time" aria-hidden="true">#</a> Time</h3><p>\u53E6\u4E00\u4E2A\u975E\u5E38\u6709\u7528\u7684\u7C7B\u662F\u5904\u7406\u65F6\u95F4\u7684\u7C7B\u3002\u8FD9\u4E2A\u7C7B\u7684\u5DE5\u4F5C\u65B9\u5F0F\u6709\u70B9\u50CFThree.js\u7684<a href="https://threejs.org/docs/#api/en/core/Clock" target="_blank" rel="noopener noreferrer">Clock</a>\u7C7B\u3002 \u8BE5\u7C7B\u4FDD\u5B58\u4E86\uFF1A</p><ul><li>\u5F53\u524D\u65F6\u95F4</li><li>the elapsed time \u7ECF\u8FC7\u7684\u65F6\u95F4</li><li>\u5F53\u524D\u5E27\u4E0E\u4E0A\u4E00\u5E27\u4E4B\u95F4\u7684\u589E\u91CF\u65F6\u95F4</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">&#39;./EventEmitter.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// Setup</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start
        <span class="token keyword">this</span><span class="token punctuation">.</span>elapsed <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>delta <span class="token operator">=</span> <span class="token number">16</span> <span class="token comment">//\u81EA\u4E0A\u4E00\u5E27\u4EE5\u6765\u82B1\u8D39\u7684\u65F6\u95F4\uFF0C16\u8FD9\u63A5\u8FD1\u4E24\u5E27\u4E4B\u95F4\u4EE5 60fps \u7684\u901F\u5EA6\u6709\u591A\u5C11\u6BEB\u79D2</span>

        window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//\u6BEB\u79D2\u4E3A\u5355\u4F4D</span>
        <span class="token keyword">const</span> currentTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>delta <span class="token operator">=</span> currentTime <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
        <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> currentTime
        <span class="token keyword">this</span><span class="token punctuation">.</span>elapsed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;tick&#39;</span><span class="token punctuation">)</span>

        window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u8BE5\u7C7B\u8FD8\u5C06\u5728\u6BCF\u4E2A\u5E27\u4E0A\u89E6\u53D1\u4E00\u4E2A\u4E8B\u4EF6\uFF0C\u4EE5\u4FBF\u6211\u4EEC\u53EF\u4EE5\u4FA6\u542C\u8BE5\u4E8B\u4EF6\u5E76\u66F4\u65B0\u6574\u4E2ACore\u7C7B</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> sizes <span class="token keyword">from</span> <span class="token string">&#39;./Utils/Sizes.js&#39;</span>
<span class="token keyword">import</span> time <span class="token keyword">from</span> <span class="token string">&#39;./Utils/Sizes.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
  	<span class="token comment">// ...</span>
  
  	<span class="token comment">// Setup</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  	<span class="token comment">// Time tick event</span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;tick&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u540E\u7EED</span>
        <span class="token comment">// this.camera.update()</span>
        <span class="token comment">// this.world.update()</span>
        <span class="token comment">// this.renderer.update()</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_2-\u6838\u5FC3\u7C7B\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_2-\u6838\u5FC3\u7C7B\u5C01\u88C5" aria-hidden="true">#</a> [2]\u6838\u5FC3\u7C7B\u5C01\u88C5</h2><h3 id="scene" tabindex="-1"><a class="header-anchor" href="#scene" aria-hidden="true">#</a> scene</h3><p>scene\u5C31\u4E0D\u5EFA\u4E00\u4E2A\u7C7B\u6765\u5C01\u88C5\u4E86\uFF0C\u76F4\u63A5\u5728Core\u7C7B\u4E2D\u521D\u59CB\u5316\uFF0C\u56E0\u4E3A\u540E\u7EED\u9700\u8981\u4F20\u9012\u7ED9\u5176\u4ED6\u7C7B\u4F7F\u7528</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="camera" tabindex="-1"><a class="header-anchor" href="#camera" aria-hidden="true">#</a> camera</h3><p>\u5BF9\u4E8E\u76F8\u673A\uFF0C\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A\u5355\u72EC\u7684\u7C7B\u6765\u62C6\u5206\u5B58\u653E\u76F8\u5173\u7684\u4EE3\u7801\uFF0C\u8FD9\u91CC\u7684\u76F8\u673A\u7C7B\u4E3B\u8981\u5305\u542B\u4E86\u900F\u89C6\u6295\u5F71\u76F8\u673A\uFF0C\u76F8\u673A\u63A7\u5236\u5668\uFF0C\u76F8\u673A\u53C2\u6570\u7684resize\u3001\u63A7\u5236\u5668\u7684update</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u7136\u540E\u518D\u4E3B\u7C7B\u4E2D\u5BFC\u5165\u5B9E\u4F8B\u5316\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>

<span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span><span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// ...</span>

  	<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  	<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u56E0\u4E3A\u5728\u76F8\u673A\u7C7B\u4E2D\u6211\u4EEC\u9700\u8981\u5B9E\u4F8B\u5316 <code>PerspectiveCamera </code>\u548C <code>OrbitControls</code> \u7C7B\u3002\u4F46\u662F\u8FD9\u4E9B\u989D\u5916\u7684\u7C7B\u9700\u8981\u50CF <code>width</code> \u548C \u8FD9\u6837\u7684 <code>height</code>\uFF0C\u8FD9\u4E5F\u5C31\u610F\u5473\u7740\u9700\u8981\u8BBF\u95EE\u4E3B\u7C7B<code>Core</code>\u7684\u53D8\u91CF\uFF08\u5C5E\u6027\uFF09 \u8FD9\u91CC\u6709\u4E09\u79CD\u65B9\u5F0F\u53EF\u4EE5\u5B9E\u73B0\u4F20\u9012<code>width</code>\u548C<code>height</code>\uFF1A</p><ul><li>\u4ECE\u5168\u5C40\u53D8\u91CF\u4E2D\u8BBF\u95EE</li><li>\u901A\u8FC7\u53C2\u6570\u4F20\u9012</li><li>\u4F7F\u7528\u5355\u4F8B</li></ul><p>\u4E0B\u9762\u8FDB\u884C\u5206\u522B\u4E3E\u4F8B\u4F7F\u7528\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/*\u4ECE\u5168\u5C40\u53D8\u91CF\u4E2D\u8BBF\u95EE\uFF0C\u5C06Experience\u4E0A\u4E0B\u6587\u6DFB\u52A0\u5230window\u5168\u5C40\u5BF9\u8C61\u4E2D*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// ...</span>

  	window<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">this</span>

		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u8FD9\u6837\u5C31\u53EF\u4EE5\u76F4\u63A5\u5728\u76F8\u673A\u7C7B\u4E2D\u4F7F\u7528\u4E86</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> window<span class="token punctuation">.</span>experience
    
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>\u4E00\u822C\u4E0D\u63A8\u8350\u4F7F\u7528window\u5168\u5C40\u53D8\u91CF\u7684\u65B9\u5F0F</p></blockquote><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/*\u901A\u8FC7\u6784\u9020\u53C2\u6570\u4F20\u9012*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    
    <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>experience<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> experience
    
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>\u6B64\u89E3\u51B3\u65B9\u6848\u662F\u4E00\u4E2A\u5F88\u597D\u7684\u89E3\u51B3\u65B9\u6848\u2019</p></blockquote><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/*\u901A\u8FC7\u6784\u9020\u5355\u4F8B\u6A21\u5F0F\uFF08\u65E0\u8BBA\u4F60\u6784\u9020\u591A\u5C11\u4E2A\u4E3B\u7C7B\uFF0C\u53EA\u6709\u7B2C\u4E00\u4E2A\u662F\u771F\u5B9E\u7684\u5B9E\u4F8B\u3002\u6240\u6709\u5176\u4ED6\u5B9E\u4F8B\u5316\u4E5F\u5C06\u8FD4\u56DE\u7B2C\u4E00\u4E2A\u5B9E\u4F8B\u3002*/</span>
<span class="token comment">// ...</span>

<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// Singleton</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">return</span> instance
    <span class="token punctuation">}</span>
    instance <span class="token operator">=</span> <span class="token keyword">this</span>
  
  <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u4F7F\u7528</span>
<span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">&#39;./Experience.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>\u8FD9\u79CD\u65B9\u5F0F\u4E5F\u633A\u4E0D\u9519\u7684</p></blockquote><p>\u7136\u540E\u63A5\u7740\u5B8C\u6210camera\u7C7B\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">&#39;./Experience.js&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;three/examples/jsm/controls/OrbitControls.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>sizes
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>canvas

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u521B\u5EFA\u900F\u89C6\u6295\u5F71\u76F8\u673A\u5E76\u5C06\u5176\u5B58\u4E3A\u4E00\u4E2Ainstance\u5B9E\u4F8B</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</span>
    <span class="token punctuation">}</span>

    <span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>aspect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>\u8FD9\u4E2A<code>resize(</code>)\u65B9\u6CD5\u548C<code>update()</code>\u65B9\u6CD5\u5728\u4E3B\u7C7B\u4E2D\u8FDB\u884C\u8C03\u7528</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span><span class="token punctuation">{</span>
 	 <span class="token comment">//...</span>
		<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      	<span class="token comment">// \u540E\u7EED</span>
        <span class="token comment">// this.renderer.resize()</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// \u540E\u7EED</span>
        <span class="token comment">// this.world.update()</span>
        <span class="token comment">// this.renderer.update()</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="renderer" tabindex="-1"><a class="header-anchor" href="#renderer" aria-hidden="true">#</a> renderer</h3><p>\u5C06\u6E32\u67D3\u76F8\u5173\u7684\u4EE3\u7801\u62C6\u5206\u4E3A\u4E00\u4E2ARenderer\u7C7B\uFF0C\u4E3B\u8981\u5305\u542B\u4E86renderer\u5B9E\u4F8B\u7684\u521B\u5EFA\u3001resize\u3001update\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> Core <span class="token keyword">from</span> <span class="token string">&#39;./Core.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>core <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>canvas
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>sizes
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>camera

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u521B\u5EFArender\u5B9E\u4F8B\u5BF9\u8C61</span>
    <span class="token punctuation">}</span>

    <span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            canvas<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span>
            antialias<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>physicallyCorrectLights <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>outputEncoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>toneMapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>CineonToneMapping
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>toneMappingExposure <span class="token operator">=</span> <span class="token number">1.75</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token string">&#39;#211d20&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>\u5728\u4E3B\u7C7B\u4E2D\u5B9E\u4F8B\u5316\u4E0E\u8C03\u7528\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ...</span>

<span class="token keyword">import</span> Renderer <span class="token keyword">from</span> <span class="token string">&#39;./Renderer.js&#39;</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
  	<span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
  		<span class="token comment">// ...</span>
  
  		<span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
 	 		<span class="token comment">// ...</span>
  	<span class="token punctuation">}</span>

  	<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_3-world" tabindex="-1"><a class="header-anchor" href="#_3-world" aria-hidden="true">#</a> [3]World</h2><p>\u5230\u6B64\u4E3A\u6B62\u6211\u4EEC\u7684\u573A\u666F\u4E2D\u4ECD\u7136\u6CA1\u6709\u4EFB\u4F55\u4E1C\u897F\uFF0C\u8FD9\u91CC\u63A8\u8350\u6784\u5EFA\u4E00\u4E2Aworld\u6587\u4EF6\u5939\u5E76\u5728\u5176\u4E2D\u521B\u5EFA\u4E00\u4E2A World \u7C7B\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Core <span class="token keyword">from</span> <span class="token string">&#39;../core.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>core <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>scene<span class="token comment">//\u83B7\u53D6scene</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4F7F\u7528</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> World <span class="token keyword">from</span> <span class="token string">&#39;./World/World.js&#39;</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
  	<span class="token comment">// ...</span>
  
  	<span class="token keyword">this</span><span class="token punctuation">.</span>world <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">World</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  	<span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u8BE5world\u7528\u6765\u653E\u7F6E\u8981\u6DFB\u52A0\u5230scene\u4E2D\u7684\u6240\u4EE5\u4E09\u7EF4\u7269\u4F53\u3001\u73AF\u5883\u3001\u5149\u7167\u7B49</p><h3 id="environment" tabindex="-1"><a class="header-anchor" href="#environment" aria-hidden="true">#</a> Environment</h3><p>\u5728world\u6587\u4EF6\u5939\u4E0B\u521B\u5EFAenvironment.js\uFF0C\u4E3B\u8981\u7528\u6765\u5B58\u653E\u5B9E\u73B0\u573A\u666F\u4E2D\u7684\u706F\u5149\u3001\u73AF\u5883\u8D34\u56FE</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">&#39;../Experience.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene

    <span class="token comment">// Setup</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u706F\u5149</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u73AF\u5883\u8D34\u56FE</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//\u6DFB\u52A0\u5149\u7167\uFF0C\u8FD9\u91CC\u6A21\u62DF\u592A\u9633\u5149</span>
  <span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">DirectionalLight</span><span class="token punctuation">(</span><span class="token string">&#39;#ffffff&#39;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">15</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>normalBias <span class="token operator">=</span> <span class="token number">0.05</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span> <span class="token number">2.25</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">0.4</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>environmentMapTexture
        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
  
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture

        <span class="token comment">/*\u5982\u679C\u4E0D\u6DFB\u52A0\u5C06\u4E0D\u8D77\u4F5C\u7528\u4E0A\u9762\u7684\u6362\u8D34\u56FE\uFF0C\u56E0\u4E3A\u73AF\u5883\u8D34\u56FE\u662F\u5728\u6DFB\u52A0\u7269\u4F53\u4E4B\u540E\u6DFB\u52A0\u7684\uFF0C\u6240\u4EE5\u9700\u8981\u904D\u5386\u573A\u666F\u4E2D\u7269\u4F53\u7684\u6750\u6599\u9700\u8981\u66F4\u65B0*/</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span><span class="token function-variable function">updateMaterials</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>Mesh <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>material <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>MeshStandardMaterial<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture
                    child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMapIntensity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>intensity
                    child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span><span class="token function">updateMaterials</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>\u7136\u540E\u518DWorld\u7C7B\u4E2D\u5B9E\u4F8B\u5316\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ...</span>
<span class="token keyword">import</span> Environment <span class="token keyword">from</span> <span class="token string">&#39;./Environment.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token comment">// ...</span>
    
     	<span class="token comment">// Setup</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h3><p>Resources\u7528\u4E8E\u5C06\u6211\u4EEC\u6240\u9700\u8981\u7684\u52A0\u8F7D\u5668\u653E\u5230\u4E00\u5757\uFF0C\u65B9\u4FBF\u7BA1\u7406 \u6211\u4EEC\u53EA\u9700\u8981\u518D\u5B9E\u4F8B\u5316\u65F6\u4F20\u9012\u4E00\u4E2Asource\u63CF\u8FF0\u5BF9\u8C61\u5373\u53EF\u5B8C\u6210\u6240\u4EE5\u8D44\u6E90\u7684\u52A0\u8F7D\u4E8E\uFF0C\u4E00\u65E6\u52A0\u8F7D\u5B8C\u6210\u6240\u6709\u7684source\uFF0C\u8FD8\u53EF\u4EE5\u89E6\u53D1\u4E00\u4E2A\u4E8B\u4EF6</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GLTFLoader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;three/examples/jsm/loaders/GLTFLoader.js&#39;</span>
<span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">&#39;./EventEmitter.js&#39;</span>

<span class="token comment">//\u56E0\u4E3A\u540E\u7EED\u9700\u8981\u89E6\u53D1\u4E8B\u4EF6\uFF0C\u6240\u4EE5\u7EE7\u627F\u4E8EEventEmitter\u6765\u5B9E\u73B0</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>sources <span class="token operator">=</span> sources

        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">//\u8981\u52A0\u8F7D\u7684sources</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toLoad <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">.</span>length
        <span class="token keyword">this</span><span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  	<span class="token comment">/*\u6839\u636E\u9879\u76EE\u9700\u8981\u7684loader\u521B\u5EFA*/</span>
    <span class="token function">setLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loaders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>gltfLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>cubeTextureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * \u904D\u5386 sources \u6570\u7EC4\u5E76\u4F7F\u7528\u76F8\u5E94\u7684\u52A0\u8F7D\u5668\u52A0\u8F7D\u5B83\u4EEC
     */</span>
    <span class="token function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Load each source</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> source <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;gltfModel&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>gltfLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
                    source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;texture&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
                    source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;cubeTexture&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>cubeTextureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
                    source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * \u4FDD\u5B58\u5C5E\u6027\u4E2D\u7684\u52A0\u8F7D\u8D44\u6E90,\u66F4\u65B0 items loaded \u5C5E\u6027\u5E76\u6D4B\u8BD5\u52A0\u8F7D\u662F\u5426\u5B8C\u6210
     * \u5982\u679C\u52A0\u8F7D\u4E86\u6240\u6709\u6E90\uFF0C\u6211\u4EEC\u5C06\u89E6\u53D1\u4E00\u4E2A ready \u4E8B\u4EF6
     * @param {*} source 
     * @param {*} file 
     */</span>
    <span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>source<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> file

        <span class="token keyword">this</span><span class="token punctuation">.</span>loaded<span class="token operator">++</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loaded <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toLoad<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>\u5B9E\u4F8B\u5316\u8C03\u7528</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code> <span class="token comment">// ...</span>

<span class="token keyword">import</span> Resources <span class="token keyword">from</span> <span class="token string">&#39;./Utils/Resources.js&#39;</span>
<span class="token keyword">import</span> sources <span class="token keyword">from</span> <span class="token string">&#39;./sources.js&#39;</span>


<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Core</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// ...</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resources</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span>

    <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u8D44\u6E90\u63CF\u8FF0\u5BF9\u8C61\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//sources.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;environmentMapTexture&#39;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&#39;cubeTexture&#39;</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span>
        <span class="token punctuation">[</span>
            <span class="token string">&#39;textures/environmentMap/px.jpg&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;textures/environmentMap/nx.jpg&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;textures/environmentMap/py.jpg&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;textures/environmentMap/ny.jpg&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;textures/environmentMap/pz.jpg&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;textures/environmentMap/nz.jpg&#39;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;grassColorTexture&#39;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&#39;texture&#39;</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">&#39;textures/dirt/color.jpg&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;grassNormalTexture&#39;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&#39;texture&#39;</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">&#39;textures/dirt/normal.jpg&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;foxModel&#39;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&#39;gltfModel&#39;</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">&#39;models/Fox/glTF/Fox.gltf&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><blockquote><ul><li>name \uFF1A\u5C06\u7528\u4E8E\u68C0\u7D22\u52A0\u8F7D\u7684\u8D44\u6E90</li><li>type \uFF1A\u4F7F\u7528\u4EC0\u4E48\u52A0\u8F7D\u5668\u7C7B\u578B</li><li>path \uFF1A\u8981\u52A0\u8F7D\u7684\u6587\u4EF6\u7684\u8DEF\u5F84</li></ul></blockquote><p>\u518DWorld\u4E2D\u6267\u884C\u52A0\u8F7D\u5B8C\u6210\u56DE\u8C03\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>resources

        <span class="token comment">//\u76D1\u542C\u52A0\u8F7D\u5B8C\u6210\u4E8B\u4EF6</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// Setup</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>floor \u53EF\u4EE5\u53C2\u7167\u8FD9\u79CD\u65B9\u5F0F\u6765\u5F80scene\u4E2D\u6DFB\u52A0\u4E09\u7EF4\u7269\u4F53\u7684\uFF08\u5148\u518Dsource.js\u4E2D\u6DFB\u52A0\u8D44\u6E90\u63CF\u8FF0\u5B57\u6BB5\uFF09\uFF0C\u6E05\u6670\u660E\u4E86\uFF0C\u6CA1\u4EC0\u4E48\u53EF\u8BF4\u7684</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> Core <span class="token keyword">from</span> <span class="token string">&#39;../core.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>core <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTextures</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">CircleGeometry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setTextures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>grassColorTexture
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping

        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>grassNormalTexture
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
        <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
    <span class="token punctuation">}</span>

    <span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            map<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">,</span>
            normalMap<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Mesh</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>material<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="fox" tabindex="-1"><a class="header-anchor" href="#fox" aria-hidden="true">#</a> fox</h3><p>\u8FD9\u91CC\u6DFB\u52A0\u4E00\u4E2A\u5E26\u52A8\u753B\u7684\u6A21\u578B\uFF0C\u540C\u6837\u9996\u5148\u6DFB\u52A0\u76F8\u5E94\u7684\u8D44\u6E90\u63CF\u8FF0\u5BF9\u8C61 \u7136\u540E\u5728World\u6587\u4EF6\u5939\u4E0B\u521B\u5EFAFox\u7C7B\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span>
<span class="token keyword">import</span> Core <span class="token keyword">from</span> <span class="token string">&#39;../Core.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>core <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>resources
        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>time
        <span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>core<span class="token punctuation">.</span>debug

      <span class="token comment">//\u540E\u7EED</span>
        <span class="token comment">// Debug</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">&#39;fox&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Resource</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>foxModel

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u6A21\u578B\u52A8\u753B</span>
    <span class="token punctuation">}</span>

    <span class="token function">setModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>Mesh<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                child<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token comment">// Mixer</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">AnimationMixer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>
        
        <span class="token comment">// Actions</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>idle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>walking <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>idle
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// Play the action</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
            <span class="token keyword">const</span> oldAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current

            newAction<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            newAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            newAction<span class="token punctuation">.</span><span class="token function">crossFadeFrom</span><span class="token punctuation">(</span>oldAction<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current <span class="token operator">=</span> newAction
        <span class="token punctuation">}</span>

        <span class="token comment">// Debug</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> debugObject <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">playIdle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;idle&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">playWalking</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;walking&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">playRunning</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;running&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playIdle&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playWalking&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playRunning&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span>delta <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div><p>\u7136\u540E\u5728World \u7C7B\u4E2D\u5B9E\u4F8B\u5316\u8C03\u7528</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> Fox <span class="token keyword">from</span> <span class="token string">&#39;./Fox.js&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  
    <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// Setup</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
	<span class="token comment">//\u540E\u7EED\uFF08\u6A21\u578B\u52A8\u753B\uFF09</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_4-debug" tabindex="-1"><a class="header-anchor" href="#_4-debug" aria-hidden="true">#</a> [4]Debug</h2><p>\u53EF\u4EE5\u5C06dat.gui\u8C03\u8BD5\u76F8\u5173\u7684\u4EE3\u7801\u5C01\u88C5\u6210\u4E00\u4E2A\u7C7B\u4F7F\u7528\uFF0C\u5728Debug\u7C7B\u4E2D\u6682\u65F6\u53EA\u521B\u5EFAdat.GUI\u7C7B</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> dat <span class="token keyword">from</span> <span class="token string">&#39;lil-gui&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Debug</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>ui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dat</span><span class="token punctuation">.</span><span class="token constant">GUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u7136\u540E\u5728Core\u7C7B\u4E2D\u4EFB\u4F55\u5176\u4ED6\u7C7B\u4E4B\u524D\u5B9E\u4F8B\u5316\u5B83\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ...</span>

<span class="token keyword">import</span> Debug <span class="token keyword">from</span> <span class="token string">&#39;./Utils/Debug.js&#39;</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      
      <span class="token comment">// Setup</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u7136\u540E\u53EA\u9700\u8981\u5728\u76F8\u5E94\u7684\u9700\u8981\u9700\u8981\u6DFB\u52A0\u8C03\u8BD5\u7684\u4E09\u7EF4\u7269\u4F53\u6216\u8005\u73AF\u5883\u4E2D\u6DFB\u52A0\u76F8\u5E94\u7684\u8C03\u8BD5\u76EE\u5F55\u5373\u53EF\uFF0C\u4F8B\u5982\uFF1A \u8C03\u8BD5fox\u6A21\u578B</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      
      <span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>debug
      
      <span class="token comment">// Debug</span>
      <span class="token keyword">const</span> debugObject <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">playIdle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;idle&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">playWalking</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;walking&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">playRunning</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">&#39;running&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      
      <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">&#39;fox&#39;</span><span class="token punctuation">)</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playIdle&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playWalking&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">&#39;playRunning&#39;</span><span class="token punctuation">)</span>
      
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u8C03\u8BD5\u73AF\u5883\u76F8\u5173\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>debug
        
        <span class="token comment">// Debug</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">&#39;environment&#39;</span><span class="token punctuation">)</span>

    
    		<span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_5-\u9500\u6BC1\u573A\u666F\u4E2D\u6240\u6709\u7684\u7269\u4F53" tabindex="-1"><a class="header-anchor" href="#_5-\u9500\u6BC1\u573A\u666F\u4E2D\u6240\u6709\u7684\u7269\u4F53" aria-hidden="true">#</a> [5]\u9500\u6BC1\u573A\u666F\u4E2D\u6240\u6709\u7684\u7269\u4F53</h2><p>\u5728scene\u4E2D\u901A\u5E38\u4F7F\u7528<code>traverse()</code> \u51FD\u6570\u6765\u904D\u5386\u573A\u666F\u4E2D\u7684\u7269\u4F53</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span><span class="token punctuation">{</span>
  

	<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;tick&#39;</span><span class="token punctuation">)</span>

        <span class="token comment">// \u904D\u5386\u573A\u666F\u4E2D\u6240\u6709\u7684\u4E1C\u897F</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// \u5224\u65AD\u662F\u5426\u4E3Amesh</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span>Mesh<span class="token punctuation">)</span><span class="token punctuation">{</span>
                child<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u91CA\u653E</span>
                <span class="token comment">//\u904D\u5386\u6BCF\u4E2Amesh\u76F8\u5E94\u7684material</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> child<span class="token punctuation">.</span>material<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">const</span> value <span class="token operator">=</span> child<span class="token punctuation">.</span>material<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

                    <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value<span class="token punctuation">.</span>dispose <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        value<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      	
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>controls<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">//\u91CA\u653E\u63A7\u4EF6</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><blockquote><p>\u672C\u6587\u90E8\u5206\u5185\u5BB9\u4E3AThree.js Journey\u8BFE\u7A0B\u7684\u5B66\u4E60\u7B14\u8BB0</p></blockquote>`,90);function j(z,C){const s=o("RouterLink");return c(),l(u,null,[n("nav",k,[n("ul",null,[n("li",null,[a(s,{to:"#_1-\u5E38\u7528\u5DE5\u5177\u7C7B\u5C01\u88C5"},{default:p(()=>[b]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#eventemitter"},{default:p(()=>[m]),_:1})]),n("li",null,[a(s,{to:"#resize"},{default:p(()=>[d]),_:1})]),n("li",null,[a(s,{to:"#time"},{default:p(()=>[w]),_:1})])])]),n("li",null,[a(s,{to:"#_2-\u6838\u5FC3\u7C7B\u5C01\u88C5"},{default:p(()=>[y]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#scene"},{default:p(()=>[h]),_:1})]),n("li",null,[a(s,{to:"#camera"},{default:p(()=>[f]),_:1})]),n("li",null,[a(s,{to:"#renderer"},{default:p(()=>[g]),_:1})])])]),n("li",null,[a(s,{to:"#_3-world"},{default:p(()=>[v]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#environment"},{default:p(()=>[x]),_:1})]),n("li",null,[a(s,{to:"#resources"},{default:p(()=>[E]),_:1})]),n("li",null,[a(s,{to:"#fox"},{default:p(()=>[T]),_:1})])])]),n("li",null,[a(s,{to:"#_4-debug"},{default:p(()=>[R]),_:1})]),n("li",null,[a(s,{to:"#_5-\u9500\u6BC1\u573A\u666F\u4E2D\u6240\u6709\u7684\u7269\u4F53"},{default:p(()=>[_]),_:1})])])]),M],64)}var H=e(i,[["render",j],["__file","three.js\u9879\u76EE\u7684\u4EE3\u7801\u7EC4\u7EC7\u7ED3\u6784.html.vue"]]);export{H as default};
