import{_ as o,r as t,o as r,a as l,b as n,d as a,w as p,F as c,e,c as k}from"./app.3f041a55.js";const u={},i={class:"table-of-contents"},b=e("1.\u6700\u90BB\u8FD1\u641C\u7D22"),m=e("[1]\u54EA\u4E9B\u5730\u65B9\u5728x\u8DDD\u79BB\u4E4B\u5185"),d=e("[2]\u4F7F\u7528ST_DWithin\u548C DISTINCT ON \u67E5\u627E\u6700\u90BB\u8FD1\u4F4D\u7F6E"),S=e("[3]\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4"),g=e("[4]\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9"),_=e("[5]\u4F7F\u7528KNN\u8DDD\u79BB\u64CD\u4F5C\u7B26\u67E5\u627E N \u4E2A\u6700\u8FD1\u7684\u70B9"),h=e("2.\u5BF9\u5730\u7406\u7C7B\u578B\u4F7F\u7528KNN\u64CD\u4F5C\u7B26"),y=e("[1]\u4F7F\u7528\u7A97\u53E3\u51FD\u6570\u5BF9\u6700\u8FD1\u7684N\u4E2A\u5730\u70B9\u8FDB\u884C\u7F16\u53F7"),w=e("3.\u5730\u7406\u6CE8\u8BB0Geotagging"),N=e("[1]\u5C06\u6570\u636E\u6807\u8BB0\u5230\u7279\u5B9A\u533A\u57DF"),T=e("[2]\u7EBF\u6027\u53C2\u8003\uFF1A\u5C06\u70B9\u6355\u6349\u5230\u6700\u8FD1\u7684\u7EBF\u4E32"),E=e("[3]PostGIS\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570"),A=k(`<p>\u6B64\u6587\u4E3A\u300Apostgis in action3 \u300B\u7684\u5B66\u4E60\u7FFB\u8BD1\u8BB0\u5F55\u5E76\u505A\u4E86\u4E9B\u5220\u51CF\u4E0E\u8865\u5145</p><h2 id="_1-\u6700\u90BB\u8FD1\u641C\u7D22" tabindex="-1"><a class="header-anchor" href="#_1-\u6700\u90BB\u8FD1\u641C\u7D22" aria-hidden="true">#</a> 1.\u6700\u90BB\u8FD1\u641C\u7D22</h2><p>\u8FD9\u4E00\u8282\u4E2D\u4E3B\u8981\u6F14\u793A\u5E38\u89C1\u7684\u591A\u79CD\u6700\u8FD1\u90BB\u8FD1\u641C\u7D22\uFF0C\u5982\uFF1A</p><ul><li>\u4F4D\u4E8EA\u7684X\u8DDD\u79BB\u4E4B\u5185\u7684geom\u6709\u90A3\u4E9B</li><li>\u8DDD\u79BBA\u7684\u6700\u8FD1\u7684N\u4E2A\u5730\u65B9\u7684geom\u6709\u90A3\u4E9B</li></ul><h3 id="_1-\u54EA\u4E9B\u5730\u65B9\u5728x\u8DDD\u79BB\u4E4B\u5185" tabindex="-1"><a class="header-anchor" href="#_1-\u54EA\u4E9B\u5730\u65B9\u5728x\u8DDD\u79BB\u4E4B\u5185" aria-hidden="true">#</a> [1]\u54EA\u4E9B\u5730\u65B9\u5728x\u8DDD\u79BB\u4E4B\u5185</h3><p>\u53EF\u4EE5\u4F7F\u7528 <code>ST_DWithin</code> \u51FD\u6570\u6765\u67E5\u627E\u5F7C\u6B64\u9760\u8FD1\u7684\u5730\u70B9\u6216\u786E\u5B9A\u4E00\u4E2A\u5730\u70B9\u662F\u5426\u5728\u53E6\u4E00\u4E2A\u5730\u70B9\u7684 X \u5355\u4F4D\u5185\uFF0C\u8FD8\u53EF\u4EE5\u5730\u7406\u7C7B\u578B\u4E0E\u51E0\u4F55\u7C7B\u578B\u6DF7\u7528\uFF08\u4E0D\u8FC7\u4F7F\u7528\u5730\u7406\u7C7B\u578B\u65F6\u662F\u4EE5\u7C73\u672A\u5355\u4F4D\uFF0C\u4E8C\u4F7F\u7528\u51E0\u4F55\u7C7B\u578B\u65F6\u662F\u7A7A\u95F4\u53C2\u8003\u7CFB\u7EDF\u76F8\u5E94\u7684\u5355\u4F4D\uFF09</p><p>\u5982\u4E0B\u793A\u4F8B\u4F7F\u7528\u5730\u7406\u7C7B\u578B\u67E5\u8BE2\u67D0\u70B9100 \u516C\u91CC\u8303\u56F4\u5185\u7684\u673A\u573A\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> name<span class="token punctuation">,</span>iso_country<span class="token punctuation">,</span>iso_region
	<span class="token keyword">from</span> ch09<span class="token punctuation">.</span>airports
<span class="token keyword">where</span> ST_DWithin<span class="token punctuation">(</span>geog<span class="token punctuation">,</span>ST_Point<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.0664</span><span class="token punctuation">,</span> <span class="token number">40.2003</span><span class="token punctuation">)</span>::geography<span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                          name                           <span class="token operator">|</span> iso_country <span class="token operator">|</span> iso_region
<span class="token comment">---------------------------------------------------------+-------------+------------</span>
 Soaring Sun Seaplane Base                               <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Bayonne Golf Club Heliport                              <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Highlands Seaplane Base                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Allen&#39;s Seaplane Base                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Caven <span class="token keyword">Point</span> USAR Center Heliport                        <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Ash Personal Heliport                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Picatinny Army Heliport                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Morristown Medical Center Heliport                      <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Honeywell Heliport                                      <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Ballymere Heliport                                      <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Weichert Headquarters Heliport                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Fla<span class="token operator">-</span>Net Airport                                         <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Trinca Airport                                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Cherry Hill Heliport                                    <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Newton Airport                                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Scheller Airport                                        <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Newton Memorial Hospital Heliport                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Colgate<span class="token operator">-</span>Palmolive<span class="token operator">/</span>Mennen Heliport                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Weiss Farm Airport                                      <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Mianecki Heliport                                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Aeroflex<span class="token operator">-</span>Andover Airport                                <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Hudson Farm West Heliport                               <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Hackettstown Community Hospital Heliport                <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Hackettstown Hospital Heliport                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Florham Park Heliport                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Soverel Park Heliport                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Newark Academy Heliport                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
<span class="token comment">-- More  --</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>[2]\u4F7F\u7528ST_DWithin\u548CST_Distance\u8FDB\u884C\u6700\u90BB\u8FD1\u641C\u7D22</p><p>\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539\uFF08\u6DFB\u52A0\u4F7F\u7528ST_Distance\u51FD\u6570\uFF09\u4E0A\u9762\u7684\u793A\u4F8B\u6765\u5B9E\u73B0\u67E5\u8BE2\u7ED3\u679C\u6309\u8DDD\u79BB\u6392\u5E8F</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ident<span class="token punctuation">,</span> name
<span class="token keyword">FROM</span> 
	ch09<span class="token punctuation">.</span>airports
	<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token comment">-- \u7B1B\u5361\u5C14\u79EF\u4EA4\u53C9\u8FDE\u63A5</span>
	<span class="token punctuation">(</span><span class="token keyword">SELECT</span> ST_Point<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.0664</span><span class="token punctuation">,</span> <span class="token number">40.2003</span><span class="token punctuation">)</span>::geography <span class="token keyword">AS</span> ref_geog<span class="token punctuation">)</span> <span class="token keyword">As</span> r
<span class="token keyword">WHERE</span> ST_DWithin<span class="token punctuation">(</span>geog<span class="token punctuation">,</span> ref_geog<span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ST_Distance<span class="token punctuation">(</span>geog<span class="token punctuation">,</span> ref_geog<span class="token punctuation">)</span> <span class="token comment">-- \u6839\u636E\u5DF2\u77E5\u70B9\u8DDD\u79BB\u67E5\u8BE2\u70B9\u7684\u8DDD\u79BB\u6765\u6392\u5E8F</span>
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">-- \u8FD4\u56DE\u524D5\u4E2A\u7ED3\u679C</span>

ident <span class="token operator">|</span>                name
<span class="token comment">-------+-------------------------------------</span>
 KNJP  <span class="token operator">|</span> Warminster Naval Air Warfare Center
 <span class="token number">31</span>PN  <span class="token operator">|</span> Control Dynamics Heliport
 PS84  <span class="token operator">|</span> Warminster Hospital Heliport
 <span class="token number">5</span>PN7  <span class="token operator">|</span> Jarrett Airport
 <span class="token number">5</span>PN4  <span class="token operator">|</span> Mahon Heliport
<span class="token punctuation">(</span><span class="token number">5</span> \u884C\u8BB0\u5F55<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-\u4F7F\u7528st-dwithin\u548C-distinct-on-\u67E5\u627E\u6700\u90BB\u8FD1\u4F4D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528st-dwithin\u548C-distinct-on-\u67E5\u627E\u6700\u90BB\u8FD1\u4F4D\u7F6E" aria-hidden="true">#</a> [2]\u4F7F\u7528ST_DWithin\u548C DISTINCT ON \u67E5\u627E\u6700\u90BB\u8FD1\u4F4D\u7F6E</h3><p>\u8FD8\u6709\u4E00\u79CD\u5E38\u89C1\u7684\u60C5\u51B5\u662F\uFF1A\u4ECE\u4E00\u7EC4\u5730\u70B9\u5F00\u59CB\uFF0C\u67E5\u627E\u8DDD\u79BB\u53E6\u4E00\u7EC4\u5730\u70B9\u6700\u8FD1\u7684\u5730\u70B9\uFF08\u5957\u4E86\u4E2A\u5A03\u{1F613}\uFF0C\u4E0D\u8FC7\u5728\u73B0\u5B9E\u751F\u6D3B\u4E2D\u8FD8\u662F\u633A\u5E38\u89C1\u7684\u9700\u6C42\uFF09\uFF0C\u4E3E\u4E2A\u4F8B\u5B50\uFF1A\u5728\u4E00\u4E2A\u4E3B\u8981\u57CE\u5E02\u7684\u6240\u6709\u7597\u517B\u9662 10 \u82F1\u91CC\u8303\u56F4\u5185\u6709\u591A\u5C11\u7D27\u6025\u533B\u7597\u4E2D\u5FC3\u3002</p><p>\u5BF9\u4E8E\u8FD9\u79CD\u60C5\u51B5\u53EF\u4EE5\u4F7F\u7528\u7EC4\u5408 <code>ST_DWithin</code> \u548C PostgreSQL <code>DISTINCT ON</code> \u6765\u5B9E\u73B0\u641C\u7D22\uFF08 DISTINCT ON \u6267\u884C\u9690\u5F0F GROUP BY\uFF0C\u4F46\u4E0D\u9650\u4E8E\u4EC5\u8FD4\u56DE\u60A8\u5206\u7EC4\u7684\u5B57\u6BB5\uFF09</p><p>\u4F8B\u5982\uFF1A\u4EE5\u4E0B\u67E5\u8BE2\u67E5\u627E\u79BB\u6BCF\u4E2A\u673A\u573A\u6700\u8FD1\u7684\u5BFC\u822A\u5DE5\u5177\uFF08\u4EA4\u901A\u7AD9\u70B9\uFF09</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token keyword">ON</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>ident<span class="token punctuation">)</span>   <span class="token comment">-- \u5BF9\u673A\u573A\u53BB\u91CD+\u6392\u5E8F\uFF0C\u4EE5\u4FDD\u7559\u5B9E\u73B0\u6700\u8FD1\u7684\u4E00\u4E2A\u5BFC\u822A\u5DE5\u5177</span>
	a<span class="token punctuation">.</span>ident<span class="token punctuation">,</span> a<span class="token punctuation">.</span>name <span class="token keyword">As</span> airport<span class="token punctuation">,</span> n<span class="token punctuation">.</span>name <span class="token keyword">As</span> closest_navaid<span class="token punctuation">,</span>
<span class="token punctuation">(</span>ST_Distance<span class="token punctuation">(</span>a<span class="token punctuation">.</span>geog<span class="token punctuation">,</span>n<span class="token punctuation">.</span>geog<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span>::<span class="token keyword">integer</span> <span class="token keyword">As</span> dist_km
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>airports <span class="token keyword">As</span> a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ch09<span class="token punctuation">.</span>navaids <span class="token keyword">As</span> n <span class="token comment">-- \u5DE6\u8FDE\u63A5\uFF08\u4EE5\u5DE6\u4E3A\u57FA\u51C6\uFF09</span>
<span class="token keyword">ON</span> ST_DWithin<span class="token punctuation">(</span>a<span class="token punctuation">.</span>geog<span class="token punctuation">,</span> n<span class="token punctuation">.</span>geog<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span> <span class="token comment">-- \u8DDD\u79BB\u673A\u573A100\u516C\u91CC\u8303\u56F4\u5185\u6700\u8FD1\u7684\u5BFC\u822A\u5DE5\u5177       </span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span>ident<span class="token punctuation">,</span> dist_km<span class="token punctuation">;</span>

ident <span class="token operator">|</span> airport <span class="token operator">|</span> closest_navaid <span class="token operator">|</span> dist_km
<span class="token comment">-------+---------------------------+--------------------+---------</span>
<span class="token number">00</span>A <span class="token operator">|</span> Total RF Heliport <span class="token operator">|</span> North Philadelphia <span class="token operator">|</span> <span class="token number">7</span>
<span class="token number">00</span>AK <span class="token operator">|</span> Lowell Field <span class="token operator">|</span> Homer <span class="token operator">|</span> <span class="token number">30</span>
<span class="token number">00</span>AL <span class="token operator">|</span> Epps Airpark <span class="token operator">|</span> Capshaw <span class="token operator">|</span> <span class="token number">10</span>
<span class="token number">00</span>AR <span class="token operator">|</span> Newport Hospital <span class="token operator">|</span> Newport <span class="token operator">|</span> <span class="token number">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>\u5176\u67E5\u627E\u7684\u5706\u534A\u5F84\u8D8A\u6162\uFF0C\u8FD9\u91CC\u67E5\u8BE2\u8FDB\u5165\u7528\u4E864\u79D2\u591A\u3002\u3002\u3002</p><p>\u6B64\u67E5\u8BE2\u4F7F\u7528\u5DE6\u8FDE\u63A5\u800C\u4E0D\u662F\u5185\u8FDE\u63A5\uFF0C\u4EE5\u786E\u4FDD\u5373\u4F7F\u5728\u6CA1\u6709\u627E\u5230\u5BFC\u822A\u8BBE\u5907\u65F6\uFF0C\u67E5\u8BE2\u64CD\u4F5C\u4ECD\u7136\u7EE7\u7EED\u8FDB\u884C</p></blockquote><h3 id="_3-\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4" tabindex="-1"><a class="header-anchor" href="#_3-\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4" aria-hidden="true">#</a> [3]\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4</h3><p>\u8FD8\u53EF\u4EE5\u4F7F\u7528ST_DWithin\u6765\u4EE3\u66FFST_Intersects\u5224\u65AD\u76F8\u4EA4\u5173\u7CFB\uFF0C\u5176\u4F18\u52BF\u6709\uFF1A</p><p>\u5F53\u6709\u4E24\u4E2A\u51E0\u4F55\u56E0\u6709\u6548\u4F4D\u6570\u5F15\u8D77\u7684\u5DEE\u5F02\u800C\u65E0\u6CD5\u76F8\u4EA4\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528<code>ST_DWithin</code>\u68C0\u67E5\u76F8\u4EA4\u3002\u4F8B\u5B50\uFF08\u5FFD\u75650.0001\u5185\u7684\u5BB9\u5DEE\uFF09\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ST_DWithin<span class="token punctuation">(</span>
	ST_GeomFromText<span class="token punctuation">(</span>
		<span class="token string">&#39;LINESTRING(1 2, 3 4)&#39;</span>
	<span class="token punctuation">)</span><span class="token punctuation">,</span>
	ST_Point<span class="token punctuation">(</span><span class="token number">3.00001</span><span class="token punctuation">,</span> <span class="token number">4.000001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token number">0.0001</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

 st_dwithin
<span class="token comment">------------</span>
 <span class="token boolean">true</span>
<span class="token punctuation">(</span><span class="token number">1</span> \u884C\u8BB0\u5F55<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5728\u4F7F\u7528\u5B9E\u9645\u7684\u6570\u636E\u65F6\u901A\u5E38\u4F1A\u4F7F\u7528\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4\uFF0C\u800C\u5E76\u975E\u6240\u6709\u6570\u636E\u90FD\u5B8C\u7F8E\u5BF9\u9F50</p><p>\u4F7F\u7528 <code>ST_DWithin</code> \u4EE3\u66FF <code>ST_Intersects</code> \u8FD8\u6709\u4E00\u4E2A\u4F18\u52BF\uFF1A<code>ST_DWithin</code> \u4E0D\u4F1A\u50CF <code>ST_Intersects</code> \u90A3\u6837\u7ECF\u5E38\u56E0\u4E3A\u65E0\u6548\u51E0\u4F55\u56FE\u5F62\u800C\u88AB\u963B\u788D\u8FC7\u7A0B\uFF0C\u5C24\u5176\u662F\u5728\u51E0\u4F55\u56FE\u5F62\u5177\u6709\u81EA\u76F8\u4EA4\u533A\u57DF\u7684\u60C5\u51B5\u4E0B\u3002 <code>ST_DWithin</code> \u4E0D\u5173\u5FC3\u6709\u6548\u6027\uFF0C\u56E0\u4E3A\u5B83\u4E0D\u4F9D\u8D56\u4E8E\u4EA4\u96C6\u77E9\u9635\uFF08\u4E5D\u4EA4\uFF09\u3002</p><h3 id="_4-\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9" tabindex="-1"><a class="header-anchor" href="#_4-\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9" aria-hidden="true">#</a> [4]\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9</h3><p>\u6709\u65F6\u5019\u8FD8\u4F1A\u6709\u4E00\u79CD\u60C5\u51B5\uFF0C\u5F53\u5728\u67E5\u8BE2\u5728\u67D0\u4E9B\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9\uFF08\u5706\u73AF\u8303\u56F4\uFF09</p><p>\u8FD9\u65F6\u5C31\u9700\u8981\u8C03\u7528\u4E24\u4E2A<code>ST_DWithin</code>\u6765\u5B9E\u73B0\u4E86\uFF0C\u5176\u4E3B\u8981\u539F\u7406\u4E3A\u4F7F\u7528\u4E24\u4E2A<code>ST_DWithin</code>\u67E5\u8BE2\u4FE9\u4E2A\u8303\u56F4\uFF08\u4E00\u5927\u4E00\u5C0F\uFF09\uFF0C\u53EA\u8981\u4FDD\u7559\u5927\u7684\u8303\u56F4\u51CF\u53BB\u5C0F\u7684\u8303\u56F4\u5373\u53EF\u3002\u5177\u4F53\u793A\u4F8B\u5982\u4E0B\uFF08\u8FD8\u662F\u673A\u573A\u8868\uFF09\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> iso_country<span class="token punctuation">,</span> iso_region
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>airports
<span class="token keyword">WHERE</span> ST_DWithin<span class="token punctuation">(</span>geog<span class="token punctuation">,</span> 
		ST_Point<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.0664</span><span class="token punctuation">,</span> <span class="token number">40.2003</span><span class="token punctuation">)</span>::geography<span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token comment">-- 100\u516C\u91CC\u8303\u56F4\u5185\u7684\u673A\u573A</span>
	<span class="token operator">AND</span> <span class="token operator">NOT</span> ST_DWithin<span class="token punctuation">(</span>geog<span class="token punctuation">,</span>
		ST_Point<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">75.0664</span><span class="token punctuation">,</span> <span class="token number">40.2003</span><span class="token punctuation">)</span>::geography<span class="token punctuation">,</span> <span class="token number">90000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 90\u516C\u91CC\u5185\u7684\u673A\u573A</span>
		
                          name                           <span class="token operator">|</span> iso_country <span class="token operator">|</span> iso_region
<span class="token comment">---------------------------------------------------------+-------------+------------</span>
 Soaring Sun Seaplane Base                               <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Bayonne Golf Club Heliport                              <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Highlands Seaplane Base                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Caven <span class="token keyword">Point</span> USAR Center Heliport                        <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Ash Personal Heliport                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Picatinny Army Heliport                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Weichert Headquarters Heliport                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Cherry Hill Heliport                                    <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Newton Airport                                          <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Newton Memorial Hospital Heliport                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Mianecki Heliport                                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Aeroflex<span class="token operator">-</span>Andover Airport                                <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Hudson Farm West Heliport                               <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Soverel Park Heliport                                   <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Kennedy Stadium Heliport                                <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 Smoketown Airport                                       <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>PA
 Hideaway Ultralightport                                 <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>PA
 Chem<span class="token operator">-</span>Fleur Helistop                                     <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 University Hospital Rooftop Heliport                    <span class="token operator">|</span> US          <span class="token operator">|</span> US<span class="token operator">-</span>NJ
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_5-\u4F7F\u7528knn\u8DDD\u79BB\u64CD\u4F5C\u7B26\u67E5\u627E-n-\u4E2A\u6700\u8FD1\u7684\u70B9" tabindex="-1"><a class="header-anchor" href="#_5-\u4F7F\u7528knn\u8DDD\u79BB\u64CD\u4F5C\u7B26\u67E5\u627E-n-\u4E2A\u6700\u8FD1\u7684\u70B9" aria-hidden="true">#</a> [5]\u4F7F\u7528KNN\u8DDD\u79BB\u64CD\u4F5C\u7B26\u67E5\u627E N \u4E2A\u6700\u8FD1\u7684\u70B9</h3><p>postgis\u6709\u5173\u4E8E\u6700\u90BB\u8FD1\u641C\u7D22\uFF08K-nearest neighbor\uFF09\u7684\u4E24\u4E2A\u64CD\u4F5C\u7B26\uFF1A</p><ul><li><code>&lt;-&gt;</code> - \u8FD9\u662F\u51E0\u4F55geometry\u548C\u5730\u7406geography\u7684 KNN \u8DDD\u79BB\u64CD\u4F5C\u7B26\uFF0C <code>A &lt;-&gt; B</code> \u8FD4\u56DE\u4E24\u4E2A\u51E0\u4F55\u56FE\u5F62 A \u548C B \u4E4B\u95F4\u7684\u8DDD\u79BB</li><li><code>&lt;#&gt;</code> - \u8FD9\u662F\u51E0\u4F55geometry\u7684 KNN \u8FB9\u754C\u6846\u8DDD\u79BB\u64CD\u4F5C\u7B26\uFF0C <code>A &lt;#&gt; B</code> \u8FD4\u56DE A \u548C B \u7684\u8FB9\u754C\u6846\u4E4B\u95F4\u7684\u6700\u5C0F\u8DDD\u79BB</li></ul><blockquote><p>\u4F7F\u7528 <code>&lt;-&gt;</code> \u65F6\uFF0C\u4E24\u4E2A\u5BF9\u8C61\u5FC5\u987B\u90FD\u662F\u51E0\u4F55\u56FE\u5F62\u6216\u4E24\u8005\u90FD\u662F\u5730\u7406\u7C7B\u578B\uFF0C\u5982\u679C\u4E0E\u5730\u7406\u8FDB\u884C\u6BD4\u8F83\uFF0C\u7ECF\u5EA6/\u7EAC\u5EA6\u7A7A\u95F4\u53C2\u8003\u7CFB\u7EDF\u4E2D\u7684\u51E0\u4F55\u56FE\u5F62\u5C06\u81EA\u52A8\u8F6C\u6362\u4E3A\u5730\u7406\uFF1B\u5982\u679C\u51E0\u4F55\u56FE\u5F62\u4F7F\u7528\u975E lon/lat \u7A7A\u95F4\u53C2\u8003\u7CFB\u7EDF\uFF0C\u5219\u4F1A\u51FA\u73B0\u9519\u8BEF</p><p>KNN \u8FD0\u7B97\u7B26\u7684\u884C\u4E3A\u4E0E\u5E38\u7528\u7684\u91CD\u53E0\u8FD0\u7B97\u7B26 (&amp;&amp;)\u3001ST_Intersects \u548C\u5176\u4ED6\u5173\u7CFB\u51FD\u6570\u975E\u5E38\u4E0D\u540C\u3002 KNN \u8FD0\u7B97\u7B26\u53EA\u80FD\u5728 ORDER BY \u5B50\u53E5\u4E2D\u4F7F\u7528\u7A7A\u95F4\u7D22\u5F15\uFF0C\u5E76\u4E14\u5F53\u8FD0\u7B97\u7B26\u4E2D\u4E00\u4FA7\u7684\u5BF9\u8C61\u5728\u67E5\u8BE2\u6216\u5B50\u67E5\u8BE2\u7684\u6574\u4E2A\u751F\u547D\u5468\u671F\u5185\u4FDD\u6301\u4E0D\u53D8\u65F6\u3002\u4EBA\u4EEC\u5E38\u72AF\u7684\u4E00\u4E2A\u9519\u8BEF\u662F\u5C1D\u8BD5\u5728 WHERE \u5B50\u53E5\u4E2D\u4F7F\u7528 KNN \u8FD0\u7B97\u7B26\uFF0C\u5E76\u60F3\u77E5\u9053\u4E3A\u4EC0\u4E48\u5B83\u4EEC\u6CA1\u6709\u83B7\u5F97\u4EFB\u4F55\u7D22\u5F15\u901F\u5EA6\u63D0\u5347\u3002 KNN \u8FD0\u7B97\u7B26\u4E5F\u603B\u662F\u8FD4\u56DE\u6570\u503C\u3002\u8FD9\u4E0E &amp;&amp;\u3001ST_Intersects \u548C\u5176\u4ED6\u5173\u7CFB\u51FD\u6570\u4E0D\u540C\uFF0C\u5B83\u4EEC\u4EC5\u5728 WHERE \u548C JOIN \u5B50\u53E5\u4E2D\u4F7F\u7528\u7A7A\u95F4\u7D22\u5F15\uFF0C\u5E76\u8FD4\u56DE\u5E03\u5C14\u503C true/false</p></blockquote><p>\u56E0\u4E3A KNN \u8FD0\u7B97\u7B26\u4F1A\u8F93\u51FA\u7684\u662F\u8DDD\u79BB\uFF0C\u8BE5\u8DDD\u79BB\u901A\u5E38\u8FD8\u662F\u9700\u8981\u5728\u67E5\u8BE2\u4E2D\u4F7F\u7528\u7684\uFF0C\u56E0\u6B64\u63A8\u8350\u5728 SELECT \u5B50\u53E5\u4E2D\u4F7F\u7528\u522B\u540D\u5B9A\u4E49\u5B83\u4EEC\u3002\u5728 ORDER BY \u5B50\u53E5\u4E2D\u4F7F\u7528\u5B9A\u4E49\u7684\u522B\u540D\u800C\u4E0D\u662F\u5728 ORDER BY \u5B50\u53E5\u4E2D\u518D\u6B21\u91CD\u590D\u6574\u4E2A &lt;-&gt; \u65F6\uFF0C\u662F\u4ECD\u7136\u53EF\u4EE5\u83B7\u5F97\u76F8\u540C\u7684\u7D22\u5F15\u63D0\u5347\u7684</p><p>\u5982\u4F7F\u7528\u7A7A\u95F4\u7D22\u5F15\u548C\u522B\u540D\u7684\u6700\u57FA\u672C\u7684 KNN \u793A\u4F8B\uFF08\u79BB\u70B9\u6700\u8FD1\u7684\u5341\u4E2A\u51E0\u4F55\u56FE\u5F62\uFF09\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	pid<span class="token punctuation">,</span>
	geom
	<span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token comment">--  return geom \u4E0E point\u7684\u8DDD\u79BB</span>
	ST_Transform<span class="token punctuation">(</span>
		ST_SetSRID<span class="token punctuation">(</span>ST_Point<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">71.09368</span><span class="token punctuation">,</span> <span class="token number">42.35857</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4326</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token number">26986</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> dist  
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>land
<span class="token keyword">WHERE</span> land_type <span class="token operator">=</span> <span class="token string">&#39;apartment&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dist <span class="token comment">-- \u6309\u8DDD\u79BB\u4ECE\u5C0F\u5230\u5927\u6392\u5E8F      </span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>

pid   <span class="token operator">|</span>       dist
<span class="token comment">--------+-------------------</span>
 <span class="token number">68</span><span class="token operator">-</span><span class="token number">74</span>  <span class="token operator">|</span> <span class="token number">577.6971291679585</span>
 <span class="token number">48</span><span class="token operator">-</span><span class="token number">154</span> <span class="token operator">|</span> <span class="token number">606.4853088634092</span>
 <span class="token number">74</span><span class="token operator">-</span><span class="token number">3</span>   <span class="token operator">|</span> <span class="token number">636.3831678954274</span>
 <span class="token number">70</span><span class="token operator">-</span><span class="token number">98</span>  <span class="token operator">|</span> <span class="token number">636.8056504490122</span>
 <span class="token number">44</span><span class="token operator">-</span><span class="token number">107</span> <span class="token operator">|</span> <span class="token number">653.9337102092323</span>
 <span class="token number">74</span><span class="token operator">-</span><span class="token number">24</span>  <span class="token operator">|</span> <span class="token number">670.4939392784329</span>
 <span class="token number">70</span><span class="token operator">-</span><span class="token number">97</span>  <span class="token operator">|</span> <span class="token number">680.0793327608731</span>
 <span class="token number">92</span><span class="token operator">-</span><span class="token number">118</span> <span class="token operator">|</span> <span class="token number">693.2394869664229</span>
 <span class="token number">75</span><span class="token operator">-</span><span class="token number">45</span>  <span class="token operator">|</span> <span class="token number">699.7823017007512</span>
 <span class="token number">42</span><span class="token operator">-</span><span class="token number">68</span>  <span class="token operator">|</span> <span class="token number">719.1473197030103</span>
<span class="token punctuation">(</span><span class="token number">10</span> \u884C\u8BB0\u5F55<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><blockquote><p>\u4E0E\u5176\u4ED6\u64CD\u4F5C\u7B26\u4E0E\u51FD\u6570\u4E00\u6837\uFF0C\u4E24\u4E2A\u51E0\u4F55\u7684\u7A7A\u95F4\u53C2\u8003\u7CFB\u7EDF\u9700\u8981\u662F\u4E00\u6837\u7684</p></blockquote><h2 id="_2-\u5BF9\u5730\u7406\u7C7B\u578B\u4F7F\u7528knn\u64CD\u4F5C\u7B26" tabindex="-1"><a class="header-anchor" href="#_2-\u5BF9\u5730\u7406\u7C7B\u578B\u4F7F\u7528knn\u64CD\u4F5C\u7B26" aria-hidden="true">#</a> 2.\u5BF9\u5730\u7406\u7C7B\u578B\u4F7F\u7528KNN\u64CD\u4F5C\u7B26</h2><p>\u5BF9\u4E8E\u5730\u7406\u7C7B\u578B\uFF0CKNN\u64CD\u4F5C\u7B26\u7684\u4F7F\u7528\u4E0E\u51E0\u4F55\u7C7B\u578B\u7C7B\u4F3C\uFF1A</p><p>\u4F8B\u5982\uFF1A\u67E5\u770B\u8DDD\u79BBBoston Logan\uFF08\u4E00\u4E2A\u673A\u573A\u540D\uFF09\u6700\u8FD1\u7684\u5341\u4E2A\u673A\u573A\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ident<span class="token punctuation">,</span> name<span class="token punctuation">,</span>
	geog <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> geog
				<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>airports <span class="token keyword">WHERE</span> ident <span class="token operator">=</span> <span class="token string">&#39;KBOS&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> dist <span class="token comment">-- Boston Logan\u5750\u6807</span>
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>airports
<span class="token keyword">WHERE</span> ident <span class="token operator">!=</span> <span class="token string">&#39;KBOS&#39;</span> <span class="token operator">AND</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">&#39;large_airport&#39;</span> <span class="token comment">-- \u4E0D\u5305\u62ECBoston Logan\u7684\u5927\u578B\u673A\u573A</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dist 
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
 ident <span class="token operator">|</span>                          name                           <span class="token operator">|</span>        dist
<span class="token comment">-------+---------------------------------------------------------+--------------------</span>
 KMHT  <span class="token operator">|</span> Manchester<span class="token operator">-</span>Boston Regional Airport                      <span class="token operator">|</span>  <span class="token number">72338.42343183087</span>
 KPVD  <span class="token operator">|</span> Theodore Francis Green State Airport                    <span class="token operator">|</span>  <span class="token number">78161.53094166022</span>
 KBDL  <span class="token operator">|</span> Bradley International Airport                           <span class="token operator">|</span>  <span class="token number">146189.5781946512</span>
 KPWM  <span class="token operator">|</span> Portland International Jetport                          <span class="token operator">|</span>  <span class="token number">153360.8589790108</span>
 KLGA  <span class="token operator">|</span> La Guardia Airport                                      <span class="token operator">|</span>  <span class="token number">296692.4314658076</span>
 KJFK  <span class="token operator">|</span> John F Kennedy International Airport                    <span class="token operator">|</span> <span class="token number">300178.39036616695</span>
 KEWR  <span class="token operator">|</span> Newark Liberty International Airport                    <span class="token operator">|</span>  <span class="token number">322306.6233001464</span>
 KBGR  <span class="token operator">|</span> Bangor International Airport                            <span class="token operator">|</span> <span class="token number">323308.49386454397</span>
 CYUL  <span class="token operator">|</span> Montreal <span class="token operator">/</span> Pierre Elliott Trudeau International Airport <span class="token operator">|</span>  <span class="token number">408984.0780492237</span>
 KSYR  <span class="token operator">|</span> Syracuse Hancock International Airport                  <span class="token operator">|</span>   <span class="token number">424727.654195591</span>
<span class="token punctuation">(</span><span class="token number">10</span> \u884C\u8BB0\u5F55<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_1-\u4F7F\u7528\u7A97\u53E3\u51FD\u6570\u5BF9\u6700\u8FD1\u7684n\u4E2A\u5730\u70B9\u8FDB\u884C\u7F16\u53F7" tabindex="-1"><a class="header-anchor" href="#_1-\u4F7F\u7528\u7A97\u53E3\u51FD\u6570\u5BF9\u6700\u8FD1\u7684n\u4E2A\u5730\u70B9\u8FDB\u884C\u7F16\u53F7" aria-hidden="true">#</a> [1]\u4F7F\u7528\u7A97\u53E3\u51FD\u6570\u5BF9\u6700\u8FD1\u7684N\u4E2A\u5730\u70B9\u8FDB\u884C\u7F16\u53F7</h3><p>\u5728\u524D\u9762\u7684\u793A\u4F8B\u4E2D\u4EC5\u4EC5\u5BF9\u67E5\u8BE2\u7684\u6700\u90BB\u8FD1\u7684\u5730\u70B9\u8FDB\u884C\u4E86\u6392\u5E8F\uFF0C\u5E76\u6CA1\u6709\u5BF9\u5176\u8FDB\u884C\u6392\u5E8F\uFF0C\u6709\u65F6\u5019\u5BF9\u5176\u8FDB\u884C\u7F16\u53F7\u4E5F\u662F\u5F88\u6709\u7528\u7684\u3002</p><p>\u8FD9\u65F6\u4FBF\u53EF\u4EE5\u4F7F\u7528 <code>row_number()</code>, <code>rank()</code>, <code>dense_rank()</code>\u7B49\u7A97\u53E3\u51FD\u6570\u5BF9\u884C\u8FDB\u884C\u7F16\u53F7\u4E86\uFF0C\u7A97\u53E3\u51FD\u6570\uFF08\u4E5F\u53EBOLAP\u51FD\u6570\uFF08Online Anallytical Processing\uFF0C\u8054\u673A\u5206\u6790\u5904\u7406\uFF09\u662F\u4E00\u79CD\u53EF\u4EE5\u67E5\u770B\u67E5\u8BE2\u7684\u6574\u4E2A\u6570\u636E\u96C6\u5E76\u63D0\u4F9B\u4E0E\u5176\u5728\u6570\u636E\u4E2D\u7684\u4F4D\u7F6E\u76F8\u5173\u7684\u4FE1\u606F\u7684\u51FD\u6570\u3002</p><p>\u7A97\u53E3\u51FD\u6570\u8BED\u6CD5\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">&lt;</span>\u7A97\u53E3\u51FD\u6570<span class="token operator">&gt;</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> <span class="token operator">&lt;</span>\u7528\u4E8E\u5206\u7EC4\u7684\u5217\u540D<span class="token operator">&gt;</span>
                <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token operator">&lt;</span>\u7528\u4E8E\u6392\u5E8F\u7684\u5217\u540D<span class="token operator">&gt;</span> <span class="token punctuation">)</span>  <span class="token comment">-- \u9ED8\u8BA4\u4E3Aasc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u793A\u4F8B\uFF1A\uFF08\u67E5\u8BE2\u6BCF\u6240\u5B66\u6821 100 \u7C73\u8303\u56F4\u5185\u7684\u9053\u8DEF\uFF0C\u5E76\u6839\u636E\u9053\u8DEF\u8DDD\u5B66\u6821\u7684\u8DDD\u79BB\u5BF9\u8FD9\u4E9B\u9053\u8DEF\u8FDB\u884C\u7F16\u53F7\uFF09</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    pid<span class="token punctuation">,</span> rnum<span class="token punctuation">,</span>  <span class="token comment">-- pid\u4E3A\u5B66\u6821\u7684\u552F\u4E00\u6807\u8BC6\u7B26</span>
	rank<span class="token punctuation">,</span> drank<span class="token punctuation">,</span>
	road_name<span class="token punctuation">,</span> 
    <span class="token function">round</span><span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>dist_km <span class="token keyword">As</span> <span class="token keyword">numeric</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">As</span> dist_km
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> 
        ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w_dist <span class="token keyword">As</span> rnum<span class="token punctuation">,</span> 
	    RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w_dist <span class="token keyword">AS</span> rank<span class="token punctuation">,</span> 
	    DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w_dist <span class="token keyword">AS</span> drank<span class="token punctuation">,</span> <span class="token comment">-- \u4E0D\u540C\u7A97\u53E3\u51FD\u6570</span>
		E<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> E<span class="token punctuation">.</span>road_name<span class="token punctuation">,</span> 
		E<span class="token punctuation">.</span>dist_km
    <span class="token keyword">FROM</span> 
		<span class="token punctuation">(</span><span class="token keyword">SELECT</span> l<span class="token punctuation">.</span>pid<span class="token punctuation">,</span>  
          <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>geom <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">&gt;</span> l<span class="token punctuation">.</span>geom<span class="token punctuation">)</span>::<span class="token keyword">numeric</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">As</span> dist_km
		 <span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>land <span class="token keyword">As</span> l <span class="token comment">-- \u5730\u70B9\u8868</span>
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token comment">-- \u5373\u4F7F\u5728 100 \u7C73\u8303\u56F4\u5185\u6CA1\u6709\u9053\u8DEF\uFF0C\u4E5F\u53EF\u4EE5\u8F93\u51FA\u5B66\u6821\u4FE1\u606F</span>
        ch09<span class="token punctuation">.</span>road <span class="token keyword">As</span> r <span class="token comment">-- \u9053\u8DEF\u8868</span>
	<span class="token keyword">ON</span> ST_DWithin<span class="token punctuation">(</span>r<span class="token punctuation">.</span>geom<span class="token punctuation">,</span>l<span class="token punctuation">.</span>geom<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span> 
	<span class="token keyword">WHERE</span> l<span class="token punctuation">.</span>land_type <span class="token operator">=</span> <span class="token string">&#39;education&#39;</span>
		<span class="token operator">AND</span> l<span class="token punctuation">.</span>pid <span class="token operator">LIKE</span> <span class="token string">&#39;143-1%&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> E
	WINDOW w_dist <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> E<span class="token punctuation">.</span>pid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> e<span class="token punctuation">.</span>dist_km<span class="token punctuation">)</span> <span class="token comment">-- \u5B9A\u4E49\u8981\u5728 OVER \u4E2D\u4F7F\u7528\u7684 WINDOW \u5B50\u53E5</span>
<span class="token punctuation">)</span> <span class="token keyword">As</span> X
<span class="token keyword">WHERE</span> X<span class="token punctuation">.</span>drank <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token comment">-- \u4EC5\u8FD4\u56DE2\u6761\u6700\u8FD1\u7684\u9053\u8DEF</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pid<span class="token punctuation">,</span> rnum<span class="token punctuation">;</span>

pid <span class="token operator">|</span> rnum <span class="token operator">|</span> rank <span class="token operator">|</span> drank <span class="token operator">|</span> road_name <span class="token operator">|</span> dist_km
<span class="token comment">--------+------+------+-------+------------------+---------</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.01</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">11</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.01</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">11</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> QUINCY STREET <span class="token operator">|</span> <span class="token number">0.06</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">11</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.06</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">11</span> <span class="token operator">|</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.06</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> KIRKLAND STREET <span class="token operator">|</span> <span class="token number">0.01</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">13</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> QUINCY STREET <span class="token operator">|</span> <span class="token number">0.07</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.06</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">15</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> KIRKLAND STREET <span class="token operator">|</span> <span class="token number">0.09</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.01</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> QUINCY STREET <span class="token operator">|</span> <span class="token number">0.01</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> BROADWAY <span class="token operator">|</span> <span class="token number">0.02</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> KIRKLAND STREET <span class="token operator">|</span> <span class="token number">0.02</span>
<span class="token number">143</span><span class="token operator">-</span><span class="token number">17</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> CAMBRIDGE STREET <span class="token operator">|</span> <span class="token number">0.02</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>\u5BF9\u4E8E\u7ED3\u679C\u7684\u89C2\u5BDF\u53EF\u4EE5\u53D1\u73B0\u8FD9\u51E0\u4E2A\u7A97\u53E3\u51FD\u6570\u5E26\u6765\u7684\u4FBF\u5229\uFF1A</p><ul><li><code>row_number()</code>:\u5BF9\u8FD4\u56DE\u7684\u7ED3\u679C\u4E2D\u6309\u7167\u67D0\u4E00\u884C\u521B\u5EFA\u4E00\u4E2A\u5B57\u6BB5\u6765\u5B58\u50A8\u6392\u5E8F\u5E8F\u53F7\uFF08\u5982\u4E0A<code>rnum</code>\uFF0Cpartition by pid\uFF09</li><li><code>rank()</code>\uFF1A\u5B9E\u9645\u4E0A\u662F\u5BF9row_number\u7684\u6269\u5C55\u5427\uFF0C\u628Adist_km\u4E2D\u76F8\u540C\u7684\u5E76\u4E3A\u540C\u4E00\u4E2A\u6392\u5E8F\u53F7</li><li><code>dense_rank()</code> :\u5BF9<code>rank()</code>\u7684\u5728\u6269\u5C55\uFF0C\u5982\u4E0A\u9762143-17\uFF0C\u7684rank\u548Cdrank\u5217\u5C31\u53EF\u4EE5\u53D1\u73B0<code>dense_rank()</code>\u662F\u5BF9<code>rank()</code>\u5408\u5E76\u540E\u7684\u884C\u8FDB\u884C\u518D\u6392\u5E8F\u3002</li></ul><h2 id="_3-\u5730\u7406\u6CE8\u8BB0geotagging" tabindex="-1"><a class="header-anchor" href="#_3-\u5730\u7406\u6CE8\u8BB0geotagging" aria-hidden="true">#</a> 3.\u5730\u7406\u6CE8\u8BB0Geotagging</h2><p>\u5730\u7406\u6807\u8BB0\u662F\u6307\u4E00\u7C7B\u7A7A\u95F4\u6280\u672F\uFF0C\u8FD9\u901A\u5E38\u6709\u4E24\u79CD\u5F62\u5F0F\uFF1A</p><ul><li><strong>\u533A\u57DF\u6807\u8BB0</strong>\uFF1A\u4F7F\u7528\u4E00\u4E2A\u6CE8\u8BB0\u6765\u6807\u6CE8\u4E00\u4E2A\u51E0\u4F55\u4F53\uFF08\u4F8B\u5982\u4F7F\u7528\u533A\u57DF\u7684\u540D\u79F0\uFF08\u5DDE\u3001\u5E02\uFF09\u6765\u6807\u6CE8\u4E00\u4E2A\u51E0\u4F55\u4F53\uFF09</li><li><strong>\u7EBF\u6027\u53C2\u8003</strong>\uFF1A\u5BF9\u7EBF\u4F7F\u7528\u7684\u4E00\u79CD\u6807\u8BB0</li></ul><p>\u533A\u57DF\u6807\u8BB0\u548C\u7EBF\u6027\u53C2\u8003\u662FGIS\u7A7A\u95F4\u5206\u6790\u51B2\u5E38\u7528\u7684\u6280\u672F\uFF0C\u4F8B\u5982\uFF0C\u5047\u8BBE\u4F60\u6709\u4E00\u4E2A\u52A0\u5229\u798F\u5C3C\u4E9A\u5DDE\u6240\u6709\u9EA6\u5F53\u52B3\u5E97\u7684\u5217\u8868\uFF0C\u5E76\u4E14\u4F60\u6709\u4E00\u4E2A\u6240\u6709\u53BF\u7684\u8868\u4F5C\u4E3A\u51E0\u4F55\u56FE\u5F62\u3002\u533A\u57DF\u5730\u7406\u6CE8\u8BB0\u53EF\u4EE5\u5C1D\u8BD5\u627E\u51FA\u54EA\u4E9B\u53BF\u5305\u542B\u54EA\u4E9B\u9EA6\u5F53\u52B3\uFF0C\u4EE5\u4FBF\u4F60\u53EF\u4EE5\u8F7B\u677E\u83B7\u5F97\u6BCF\u4E2A\u53BF\u7684\u9EA6\u5F53\u52B3\u6570\u91CF\u3002\u76F8\u53CD\uFF0C\u5982\u679C\u4F60\u6709\u52A0\u5229\u798F\u5C3C\u4E9A\u5DDE\u6240\u6709\u4E3B\u8981\u9AD8\u901F\u516C\u8DEF\u7684\u5217\u8868\uFF0C\u5219\u7EBF\u6027\u53C2\u8003\u53EF\u4EE5\u627E\u51FA\u54EA\u4E9B\u9AD8\u901F\u516C\u8DEF\u5728\u8DEF\u8FB9\u6709\u54EA\u4E9B\u9EA6\u5F53\u52B3\u5E97\uFF08\u8FD9\u53EA\u662F\u4F7F\u7528\u7EBF\u6027\u53C2\u8003\u7684\u4E00\u79CD\u60C5\u51B5\uFF0C\u66F4\u591A\u5E38\u89C1\u7684\u60C5\u51B5https://www.jianshu.com/p/4916b85bea65\uFF09</p><h3 id="_1-\u5C06\u6570\u636E\u6807\u8BB0\u5230\u7279\u5B9A\u533A\u57DF" tabindex="-1"><a class="header-anchor" href="#_1-\u5C06\u6570\u636E\u6807\u8BB0\u5230\u7279\u5B9A\u533A\u57DF" aria-hidden="true">#</a> [1]\u5C06\u6570\u636E\u6807\u8BB0\u5230\u7279\u5B9A\u533A\u57DF</h3><p>\u7A7A\u95F4\u6570\u636E\u5E93\u66F4\u5E38\u89C1\u7684\u7528\u9014\u4E4B\u4E00\u662F\u6807\u8BB0\u533A\u57DF\u3002\u901A\u5E38\uFF0C\u60A8\u4F1A\u5C06\u7A7A\u95F4\u533A\u57DF\u547D\u540D\u4E3A\u591A\u8FB9\u5F62\u6216\u591A\u591A\u8FB9\u5F62\u3002\u8FD9\u4E9B\u53EF\u80FD\u662F\u653F\u6CBB\u533A\u3001\u9500\u552E\u533A\u3001\u5E02\u6216\u5176\u4ED6\u4EFB\u4F55\u5730\u65B9\u3002</p><p>\u4E0B\u9762\u770B\u4E00\u4E2A\u57FA\u4E8E airports \u8868\u7684\u793A\u4F8B\u3002\u52A0\u5165\u4F60\u60F3\u8981\u67E5\u627E\u5E76\u5B58\u50A8\u6240\u6709\u673A\u573A\u7684\u65F6\u533A\u3002\u800C\u65F6\u533A\u533A\u57DF\u5C06\u8868\u4E3A\u591A\u9762\u4F53\u8868 (ch09.tz_world)\uFF0C\u90A3\u4E48\u5BF9\u4E8E\u6BCF\u4E2A\u673A\u573A\uFF0C\u9700\u8981\u5148\u6839\u636E\u673A\u573A\u7684\u5750\u6807\u627E\u5230\u5B83\u6240\u5728\u7684\u65F6\u533A\u591A\u9762\u4F53\uFF0C\u5E76\u5C06\u5176\u65F6\u533A\u8BBE\u7F6E\u4E3A\u8BE5\u533A\u57DF\u7684\u65F6\u533A\u503C\u3002\u4EE5\u4E0B\u793A\u4F8B\u4F7F\u7528\u76F8\u5E94\u65F6\u533A\u591A\u9762\u4F53\u4E2D\u7684\u65F6\u533A\u503C\u66F4\u65B0\u673A\u573A\u7684\u65F6\u533A\u5B57\u6BB5</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5513ffe4234f4a55bf67dd54d72f4ddf~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><blockquote><p>ch09.tz_world</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> ch09<span class="token punctuation">.</span>airports <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> tz <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- \u6DFB\u52A0\u4E00\u4E2A\u65F6\u533A\u5217</span>
<span class="token keyword">UPDATE</span> ch09<span class="token punctuation">.</span>airports
<span class="token keyword">SET</span> tz <span class="token operator">=</span> t<span class="token punctuation">.</span>tzid
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>tz_world <span class="token keyword">As</span> t
<span class="token keyword">WHERE</span> ST_Intersects<span class="token punctuation">(</span>ch09<span class="token punctuation">.</span>airports<span class="token punctuation">.</span>geog<span class="token punctuation">,</span> t<span class="token punctuation">.</span>geog<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- \u673A\u573A\u70B9\u4E8E\u65F6\u533A\u591A\u8FB9\u5F62\u76F8\u4EA4\u5904</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u8FD9\u6837\uFF0C\u8981\u663E\u793A\u6BCF\u4E2A\u673A\u573A\u7684\u5F53\u524D\u672C\u5730\u65F6\u95F4\u7684\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u5185\u7F6E\u7684 PostgreSQL \u65F6\u533A\u51FD\u6570\u4E0E\u6839\u636E\u60A8tz\u5217\u6307\u5B9A\u7684\u65F6\u533A\u6765\u8BA1\u7B97\u4E86</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>SELECT ident, name, CURRENT_TIMESTAMP AT TIME ZONE tz AS ts_at_airport
FROM ch09.airports
WHERE ident IN(&#39;KBOS&#39;,&#39;KSAN&#39;,&#39;LIRF&#39;,&#39;OMDB&#39;,&#39;ZLXY&#39;);
 ident |                        name                         |       ts_at_airport
-------+-----------------------------------------------------+----------------------------
 KBOS  | General Edward Lawrence Logan International Airport | 2022-11-15 00:54:41.464544
 KSAN  | San Diego International Airport                     | 2022-11-14 21:54:41.464544
 LIRF  | Leonardo da Vinci\u2013Fiumicino Airport                | 2022-11-15 06:54:41.464544
 OMDB  | Dubai International Airport                         | 2022-11-15 09:54:41.464544
 ZLXY  | Xi&#39;an Xianyang International Airport                | 2022-11-15 13:54:41.464544
(5 \u884C\u8BB0\u5F55)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-\u7EBF\u6027\u53C2\u8003-\u5C06\u70B9\u6355\u6349\u5230\u6700\u8FD1\u7684\u7EBF\u4E32" tabindex="-1"><a class="header-anchor" href="#_2-\u7EBF\u6027\u53C2\u8003-\u5C06\u70B9\u6355\u6349\u5230\u6700\u8FD1\u7684\u7EBF\u4E32" aria-hidden="true">#</a> [2]\u7EBF\u6027\u53C2\u8003\uFF1A\u5C06\u70B9\u6355\u6349\u5230\u6700\u8FD1\u7684\u7EBF\u4E32</h3><p>\u4E00\u79CD\u5E38\u89C1\u7684\u7EBF\u6027\u53C2\u8003\u5F62\u5F0F\u4E3A\u5C06\u6700\u8FD1\u7EBF\u4E32\u4E0A\u7684\u6700\u8FD1\u70B9\u8FD4\u56DE\u5230\u53C2\u8003\u70B9\u3002\u8FD9\u79CD\u7EBF\u6027\u53C2\u8003\u901A\u5E38\u88AB\u79F0\u4E3A\u6355\u6349\u70B9\u5230\u6700\u8FD1\u7684\u7EBF\u4E32\u3002\u4ECE\u4E00\u7EC4\u70B9\u548C\u4E00\u7EC4\u7EBF\u4E32\u5F00\u59CB\u5C1D\u8BD5\u5C06\u6BCF\u4E2A\u70B9\u4E0E\u5176\u6700\u8FD1\u7684\u7EBF\u4E32\u76F8\u5173\u8054\uFF0C\u7136\u540E\u4E0E\u8BE5\u7EBF\u4E32\u4E0A\u7684\u6700\u8FD1\u70B9\u76F8\u5173\u8054</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token keyword">ON</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>  <span class="token comment">-- \u53EA\u4FDD\u7559\u6700\u8FD1\u7684\u5730\u5757\u548C\u9053\u8DEF\u5BF9</span>
    p<span class="token punctuation">.</span>addr_num <span class="token operator">||</span> <span class="token string">&#39; &#39;</span> <span class="token operator">||</span> full_str <span class="token keyword">AS</span> parcel<span class="token punctuation">,</span> 
    r<span class="token punctuation">.</span>road_name <span class="token keyword">AS</span> road<span class="token punctuation">,</span>
    ST_ClosestPoint<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span>r<span class="token punctuation">.</span>geom<span class="token punctuation">)</span> <span class="token keyword">As</span> snapped_point <span class="token comment">-- return\u70B9\u5230\u76F4\u7EBF\u6700\u8FD1\u7684\u70B9\uFF08\u76F4\u7EBF\u4E0A\uFF09</span>
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>land <span class="token keyword">AS</span> p <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> ch09<span class="token punctuation">.</span>road <span class="token keyword">AS</span> r
<span class="token keyword">ON</span> ST_DWithin<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span>r<span class="token punctuation">.</span>geom<span class="token punctuation">,</span><span class="token number">20.0</span><span class="token punctuation">)</span> <span class="token comment">-- \u4EC5\u5728land\u4E0Eroad20\u7C73\u8303\u56F4\u5185\u751F\u6210</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> p<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> ST_Distance<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span>r<span class="token punctuation">.</span>geom<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30874ef63b3642f198854ddfc350be06~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/668a167e6f3c4525830bd2f854c345d4~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b3998c0b19a4b52ae3a19320e3b7ee6~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><blockquote><p><code>ST_ClosestPoint(geometry A, geometry B)</code>\uFF1A\u5728\u70B9\u4E0E\u7EBF\u4E32\u4E4B\u95F4\u7684\u6700\u63A5\u8FD1\u662F\u70B9\u672C\u8EAB\uFF0C\u4F46\u662F\u5728\u7EBF\u6761\u548C\u70B9\u4E4B\u95F4\u7684\u6700\u63A5\u8FD1\u7684\u70B9\u662F\u7EBF\u5B57\u7B26\u4E32\u4E0A\u6700\u63A5\u8FD1\u7684\u70B9\u3002</p><p>\u5176\u4ED6\u60C5\u51B5\uFF0C\u5219\u662F\u591A\u8FB9\u5F62A\u5230\u591A\u8FB9\u5F62B\u4E0A\u6700\u8FD1\u7684\u70B9\uFF08\u751F\u6210\uFF09</p></blockquote><h3 id="_3-postgis\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#_3-postgis\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570" aria-hidden="true">#</a> [3]PostGIS\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570</h3><p>PostGIS 2.3 \u63A8\u51FA\u4E86\u7B2C\u4E00\u4E2A\u7279\u5B9A\u4E8E PostGIS \u7684\u7A97\u53E3\u51FD\u6570\uFF1A<code>ST_ClusterDBSCAN</code> \u548C <code>ST_ClusterKMeans</code></p><p>\u8FD9\u4E9B\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570\u53EF\u4EE5\u6839\u636E\u51E0\u4F55\u5BF9\u8C61\u5F7C\u6B64\u7684\u63A5\u8FD1\u7A0B\u5EA6\u5C06\u5B83\u4EEC\u805A\u96C6\u5728\u4E00\u8D77\u3002</p><p>\u8FD9\u91CC\u4E3E\u4E00\u4E2A\u793A\u4F8B\uFF1A\u5047\u5982\u73B0\u5728\u6709\u4E00\u6279\u533B\u62A4\u4EBA\u5458\u8981\u6839\u636E\u5730\u5740\u5BF9\u9700\u8981\u7684\u4EBA\u8FDB\u884C\u75AB\u82D7\u6CE8\u518C\uFF0C\u90A3\u4E48\u786E\u4FDD\u7ED9\u4ED6\u4EEC\u5206\u914D\u7684\u5730\u5740\u6570\u91CF\u5747\u5300\u4E14\u4E0D\u4F1A\u592A\u79BB\u6563\u3002\u8FD9\u65F6\u5C31\u53EF\u4EE5\u53D1\u6325postgis\u7A7A\u95F4\u805A\u5408\u51FD\u6570\u7684\u4F5C\u7528\u4E86\uFF0C\u5B83\u53EF\u4EE5\u5C06\u6570\u636E\u96C6\u5212\u5206\u4E3A\u591A\u4E2A\u5757\uFF0C\u5176\u4E2D\u6BCF\u4E2A\u5757\u4EE3\u8868\u4E00\u7EC4\u63A5\u8FD1\u7A0B\u5EA6\u9AD8\u7684\u4E8B\u7269\u3002\u8BE5\u7A97\u53E3\u51FD\u6570\u8FD4\u56DE\u7C07\u53F7\uFF08cluster number\uFF09\uFF0C\u5177\u6709\u76F8\u540C\u65CF\u53F7\u7684\u8BB0\u5F55\u5C06\u4EE3\u8868\u5E94\u5206\u914D\u7ED9\u7279\u5B9A\u5458\u5DE5\u7684\u4E00\u6279\u5730\u5740</p><ul><li><code>integer ST_ClusterKMeans(geometry geom_of_clusters, integer number_of_clusters);</code> \u9700\u8981\u4F20\u5165\u5C06\u6570\u636E\u5206\u6210\u7684\u805A\u7C7B\u6570\u91CF\uFF0C\u5B83\u4F1A\u4F7F\u7528\u6B64\u6570\u91CF\u6839\u636E\u4E0E\u96C6\u5408\u4E2D\u5176\u4ED6\u884C\u7684\u63A5\u8FD1\u7A0B\u5EA6\u5C06\u805A\u7C7B\u5206\u914D\u7ED9\u8BB0\u5F55\u3002</li><li><code>integer ST_ClusterDBSCAN(geometry geom, float8 eps, integer minpoints)</code> \u4E0D\u9700\u8981\u6307\u5B9A\u591A\u4E2A\u7C07\u3002 \u4E00\u4E2A\u5212\u5B9A\u8DDD\u79BB\uFF0C\u5728\u8FD9\u4E00\u8DDD\u79BB\u5185\u5F97\u51E0\u4F55\u5C06\u88AB\u5212\u4E3A\u4E00\u4E2A\u65CF\uFF0C\uFF0C\u53E6\u5916\u8FD8\u6709\u4E00\u4E2A<code>minpoints</code>\u6570\uFF0C\u5C31\u662F\u4F60\u5E0C\u671B\u4E00\u4E2A\u805A\u7C7B\u4E2D\u6700\u5C11\u7684\u6210\u5458\u6570</li></ul><p>\u8FD9\u4E24\u79CD\u805A\u7C7B\u7A97\u53E3\u51FD\u6570\u7684\u4F7F\u7528\u793A\u4F8B\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span>
    <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>addr_num <span class="token operator">||</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> full_str <span class="token keyword">AS</span> address<span class="token punctuation">,</span>
    ST_ClusterKMeans<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> kcluster<span class="token punctuation">,</span> <span class="token comment">-- \u5206\u4E3A4\u4E2A\u805A\u7C7B[0,3]</span>
    ST_ClusterDBSCAN<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> dcluster <span class="token comment">-- \u6700\u5927\u8DDD\u79BB\u4E3A15\u7C73\uFF0C\u6BCF\u4E2A\u805A\u7C7B\u4E2D\u81F3\u5C11\u67092\u4E2A\u6210\u5458</span>
<span class="token keyword">FROM</span> ch09<span class="token punctuation">.</span>land <span class="token keyword">AS</span> p
<span class="token keyword">WHERE</span> ST_DWithin<span class="token punctuation">(</span>p<span class="token punctuation">.</span>geom<span class="token punctuation">,</span> 
      ST_GeomFromText<span class="token punctuation">(</span><span class="token string">&#39;POINT(233110 900676)&#39;</span><span class="token punctuation">,</span> <span class="token number">26986</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5728\u8FD9\u4E24\u79CD\u60C5\u51B5\u4E0B\uFF0C\u9009\u62E9\u7684\u6307\u6807\u4F1A\u4EA7\u751F\u5927\u7EA6\u56DB\u4E2A\u805A\u7C7B</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b28ebc1200df47e5810e57df73434dc1~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e547f993042f49699b5916886a0e8776~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8b9f6862cb5496aa827c9d8c03ad00b~tplv-k3u1fbpfcp-zoom-1.image" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0">****</p>`,77);function U(R,f){const s=t("RouterLink");return r(),l(c,null,[n("nav",i,[n("ul",null,[n("li",null,[a(s,{to:"#_1-\u6700\u90BB\u8FD1\u641C\u7D22"},{default:p(()=>[b]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#_1-\u54EA\u4E9B\u5730\u65B9\u5728x\u8DDD\u79BB\u4E4B\u5185"},{default:p(()=>[m]),_:1})]),n("li",null,[a(s,{to:"#_2-\u4F7F\u7528st-dwithin\u548C-distinct-on-\u67E5\u627E\u6700\u90BB\u8FD1\u4F4D\u7F6E"},{default:p(()=>[d]),_:1})]),n("li",null,[a(s,{to:"#_3-\u5E26\u5BB9\u5DEE\u7684\u76F8\u4EA4"},{default:p(()=>[S]),_:1})]),n("li",null,[a(s,{to:"#_4-\u8DDD\u79BB\u8303\u56F4\u5185\u7684\u5730\u70B9"},{default:p(()=>[g]),_:1})]),n("li",null,[a(s,{to:"#_5-\u4F7F\u7528knn\u8DDD\u79BB\u64CD\u4F5C\u7B26\u67E5\u627E-n-\u4E2A\u6700\u8FD1\u7684\u70B9"},{default:p(()=>[_]),_:1})])])]),n("li",null,[a(s,{to:"#_2-\u5BF9\u5730\u7406\u7C7B\u578B\u4F7F\u7528knn\u64CD\u4F5C\u7B26"},{default:p(()=>[h]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#_1-\u4F7F\u7528\u7A97\u53E3\u51FD\u6570\u5BF9\u6700\u8FD1\u7684n\u4E2A\u5730\u70B9\u8FDB\u884C\u7F16\u53F7"},{default:p(()=>[y]),_:1})])])]),n("li",null,[a(s,{to:"#_3-\u5730\u7406\u6CE8\u8BB0geotagging"},{default:p(()=>[w]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#_1-\u5C06\u6570\u636E\u6807\u8BB0\u5230\u7279\u5B9A\u533A\u57DF"},{default:p(()=>[N]),_:1})]),n("li",null,[a(s,{to:"#_2-\u7EBF\u6027\u53C2\u8003-\u5C06\u70B9\u6355\u6349\u5230\u6700\u8FD1\u7684\u7EBF\u4E32"},{default:p(()=>[T]),_:1})]),n("li",null,[a(s,{to:"#_3-postgis\u7A7A\u95F4\u805A\u5408\u7A97\u53E3\u51FD\u6570"},{default:p(()=>[E]),_:1})])])])])]),A],64)}var I=o(u,[["render",U],["__file","PostGIS\u9886\u57DF\u5206\u6790.html.vue"]]);export{I as default};
